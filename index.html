<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RainClone ‚Äî Demo Casino (client-side)</title>
<style>
  /* ---------- Base / Layout ---------- */
  :root{
    --bg:#07070a; --card:#0f1116; --muted:#9aa0a6; --accent:#6ad1ff; --gold:#f0c95f;
    --glass: rgba(255,255,255,0.03);
    --radius:12px;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Segoe UI Mono", monospace;
  }
  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  body{background:
    radial-gradient(1000px 400px at 10% 10%, rgba(106,209,255,0.04), transparent 10%),
    radial-gradient(800px 300px at 90% 90%, rgba(240,201,95,0.03), transparent 10%),
    var(--bg); color:#e6eef7; -webkit-font-smoothing:antialiased; padding:18px;}
  .app{max-width:1200px; margin:0 auto; display:grid; grid-template-columns:280px 1fr 320px; gap:18px; align-items:start;}
  header{grid-column:1 / -1; display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:6px}
  .brand{display:flex; gap:12px; align-items:center}
  .logo{width:54px;height:54px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--gold));display:flex;align-items:center;justify-content:center;font-weight:700;}
  h1{font-size:1.25rem; margin:0}
  .sub{color:var(--muted); font-size:0.9rem}

  /* ---------- Left column: wallet & quick controls ---------- */
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); padding:14px; border-radius:var(--radius); box-shadow: 0 6px 22px rgba(0,0,0,0.45);}
  .left .balance{font-size:1.6rem; font-weight:700; display:flex; align-items:baseline; gap:8px}
  .small{font-size:0.85rem; color:var(--muted)}

  .controls{margin-top:12px; display:flex; gap:8px; flex-direction:column}
  input[type=number], input[type=text], select{width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit}
  .btn{background:linear-gradient(180deg,var(--accent), rgba(106,209,255,0.8)); color:#021826; font-weight:700; padding:8px 12px; border-radius:8px; border:none; cursor:pointer}
  .btn.ghost{background:transparent; color:var(--muted); border:1px dashed rgba(255,255,255,0.03)}

  /* ---------- Center: main game area ---------- */
  .center{min-height:520px; display:flex; flex-direction:column; gap:12px}
  .tabs{display:flex; gap:8px}
  .tab{padding:8px 12px; border-radius:10px; background:transparent; border:1px solid transparent; color:var(--muted); cursor:pointer}
  .tab.active{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); color:var(--accent); border-color:rgba(106,209,255,0.08)}
  .game-area{margin-top:6px; padding:16px; border-radius:var(--radius); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); min-height:420px; display:flex; flex-direction:column; gap:12px; }

  /* ---------- Crash specific ---------- */
  .crash-top{display:flex; align-items:center; justify-content:space-between; gap:10px}
  .multiplier{font-family:var(--mono); font-size:2.4rem; font-weight:800; color:var(--accent)}
  .crash-canvas{height:120px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-radius:10px; overflow:hidden; display:flex; align-items:flex-end; padding:8px}
  .crash-graph{width:100%; height:100%}

  /* ---------- Mini cards ---------- */
  .mini{display:flex; gap:8px; align-items:center}
  .chip{background:var(--gold); color:#051019; padding:6px 10px; border-radius:8px; font-weight:700}

  /* ---------- Right: recent wins / provably-fair ---------- */
  .ticker{height:220px; overflow:hidden; padding:8px; border-radius:8px; background:rgba(255,255,255,0.01)}
  .win-row{display:flex; justify-content:space-between; padding:6px 8px; border-radius:6px; margin-bottom:6px; font-size:0.95rem}
  .win-green{color:#b7f7c1}
  .small-muted{color:var(--muted); font-size:0.85rem}

  /* ---------- Slots styles ---------- */
  .slots{display:flex; gap:12px; align-items:center; justify-content:center}
  .reel{width:80px; height:120px; border-radius:8px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); display:flex; align-items:center; justify-content:center; font-size:1.8rem; font-weight:800; box-shadow: inset 0 -8px 18px rgba(0,0,0,0.6)}
  .reel.spin{animation:spinReel 0.7s cubic-bezier(.2,.9,.3,1)}

  @keyframes spinReel{
    0%{transform:translateY(-40px) scaleY(1.02)}
    100%{transform:translateY(0) scaleY(1)}
  }

  /* ---------- Mines grid ---------- */
  .mines-grid{display:grid; grid-template-columns: repeat(6, 1fr); gap:6px}
  .mine-cell{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-radius:8px; height:48px; display:flex; align-items:center; justify-content:center; cursor:pointer; user-select:none}
  .mine-open{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}

  /* ---------- Responsive ---------- */
  @media (max-width:1000px){
    .app{grid-template-columns: 1fr; padding:12px}
    header{flex-direction:column; align-items:flex-start}
  }

  /* ---------- Footer tiny ---------- */
  footer{grid-column:1/-1; text-align:center; margin-top:12px; color:var(--muted); font-size:0.85rem}
</style>
</head>
<body>
<div style="max-width:1200px;margin:0 auto;padding-bottom:24px">
  <header>
    <div class="brand">
      <div class="logo">RC</div>
      <div>
        <h1>RainClone <span class="small" style="margin-left:8px">demo ‚Ä¢ client-only</span></h1>
        <div class="sub">Fake currency, improved UI, provably-fair demo</div>
      </div>
    </div>

    <div style="display:flex; gap:10px; align-items:center">
      <div class="small-muted">Balance</div>
      <div class="chip" id="headerBalance">0 RC</div>
    </div>
  </header>

  <div class="app">
    <!-- LEFT -->
    <div class="left">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Wallet</div>
            <div class="balance" id="balanceDisplay">0 <span style="font-size:0.7rem;color:var(--muted);">RC</span></div>
          </div>
          <button class="btn ghost" id="resetBtn" title="Reset local demo">Reset</button>
        </div>

        <div class="controls">
          <label class="small-muted">Quick bet</label>
          <input id="quickBet" type="number" min="1" value="50" />
          <label class="small-muted">Auto Bet: rounds</label>
          <input id="autoRounds" type="number" min="1" value="10" />
          <div style="display:flex; gap:8px;">
            <button class="btn" id="addFunds">+ Add 1000 RC</button>
            <button class="btn ghost" id="saveBtn">Save</button>
          </div>
        </div>

        <hr style="margin:12px 0; border:none; height:1px; background:rgba(255,255,255,0.02)">

        <div class="small-muted">Quick actions</div>
        <div style="display:flex; gap:8px; margin-top:8px">
          <button class="tab" data-game="crash">Crash</button>
          <button class="tab" data-game="dice">Dice</button>
          <button class="tab" data-game="mines">Mines</button>
          <button class="tab" data-game="slots">Slots</button>
        </div>

        <hr style="margin:12px 0; border:none; height:1px; background:rgba(255,255,255,0.02)">
        <div class="small-muted">Bet History</div>
        <div id="history" style="max-height:200px; overflow:auto; margin-top:8px"></div>
      </div>
    </div>

    <!-- CENTER -->
    <div class="center">
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div style="display:flex; gap:10px; align-items:center">
            <div class="tabs" id="tabs">
              <button class="tab active" data-game="crash">Crash</button>
              <button class="tab" data-game="dice">Dice</button>
              <button class="tab" data-game="mines">Mines</button>
              <button class="tab" data-game="slots">Slots</button>
            </div>
            <div class="small-muted">Focused game</div>
          </div>

          <div style="display:flex; gap:8px; align-items:center">
            <div class="small-muted">Auto-bet</div>
            <label style="display:flex;gap:6px;align-items:center">
              <input id="autoToggle" type="checkbox" /> <span class="small-muted" style="margin-left:4px">On</span>
            </label>
            <div class="small-muted">Multiplier/Target:</div>
            <input id="autoTarget" type="number" min="1.01" step="0.01" value="2.00" style="width:90px" />
          </div>
        </div>

        <div class="game-area" id="gameArea">
          <!-- Crash game -->
          <div id="crashGame">
            <div class="crash-top">
              <div>
                <div class="small-muted">Round</div>
                <div style="display:flex;gap:8px;align-items:center">
                  <div class="mini"><div class="small-muted">Status</div><div id="crashStatus" style="margin-left:8px" class="small-muted">Idle</div></div>
                  <div class="mini"><div class="small-muted">Round ID</div><div id="roundId" style="margin-left:8px" class="small-muted mono">‚Äî</div></div>
                </div>
              </div>
              <div style="text-align:right">
                <div class="small-muted">Multiplier</div>
                <div class="multiplier" id="multText">1.00x</div>
              </div>
            </div>

            <div class="crash-canvas">
              <canvas id="crashCanvas" class="crash-graph"></canvas>
            </div>

            <div style="display:flex; gap:12px; align-items:center; justify-content:space-between;">
              <div style="display:flex; gap:8px; align-items:center;">
                <div class="small-muted">Bet</div>
                <input id="crashBet" type="number" min="1" value="50" style="width:110px" />
                <div class="small-muted">Auto cashout</div>
                <input id="cashoutAt" type="number" min="1.01" step="0.01" value="2.00" style="width:90px" />
              </div>

              <div style="display:flex; gap:8px;">
                <button class="btn" id="placeBetCrash">Place & Start</button>
                <button class="btn ghost" id="cashoutBtn">Cashout</button>
              </div>
            </div>
          </div>

          <!-- Dice -->
          <div id="diceGame" style="display:none">
            <div style="display:flex; gap:12px; align-items:center; justify-content:space-between;">
              <div>
                <div class="small-muted">Pick target (1-6)</div>
                <select id="dicePick">
                  <option value="4">4 ‚Äî win if roll ‚â• 4</option>
                  <option value="5">5 ‚Äî win if roll ‚â• 5</option>
                  <option value="6">6 ‚Äî win if roll = 6</option>
                </select>
              </div>
              <div>
                <div class="small-muted">Bet</div>
                <input id="diceBet" type="number" min="1" value="50" style="width:120px" />
              </div>
              <div>
                <button class="btn" id="diceRoll">Roll</button>
              </div>
            </div>
            <div style="margin-top:8px">
              <div id="diceResult" class="small-muted">Roll result will appear here.</div>
            </div>
          </div>

          <!-- Mines -->
          <div id="minesGame" style="display:none">
            <div style="display:flex; gap:12px; align-items:center; margin-bottom:10px;">
              <div>
                <div class="small-muted">Bombs</div>
                <select id="bombCount">
                  <option value="3">3 bombs (easier)</option>
                  <option value="5" selected>5 bombs</option>
                  <option value="8">8 bombs (hard)</option>
                </select>
              </div>
              <div>
                <div class="small-muted">Bet</div>
                <input id="minesBet" type="number" min="1" value="50" style="width:120px" />
              </div>
              <div>
                <button class="btn" id="startMines">Start</button>
                <button class="btn ghost" id="cashoutMines">Cashout</button>
              </div>
            </div>
            <div class="mines-grid" id="minesGrid"></div>
            <div style="margin-top:8px" class="small-muted">Open cells to increase multiplier. Hit a bomb = lose.</div>
          </div>

          <!-- Slots -->
          <div id="slotsGame" style="display:none">
            <div style="display:flex; gap:12px; align-items:center; justify-content:space-between;">
              <div>
                <div class="small-muted">Bet</div>
                <input id="slotsBet" type="number" min="1" value="50" style="width:120px" />
              </div>
              <div>
                <button class="btn" id="spinSlots">Spin</button>
              </div>
            </div>
            <div class="slots" style="margin-top:12px">
              <div class="reel" id="r1">üçí</div>
              <div class="reel" id="r2">üçã</div>
              <div class="reel" id="r3">üîî</div>
            </div>
            <div style="margin-top:10px" id="slotsResult" class="small-muted">Try your luck ‚Äî matching 3 gives big wins.</div>
          </div>
        </div>
      </div>

      <!-- Bottom: extra settings -->
      <div style="display:flex; gap:12px">
        <div class="card" style="flex:1">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
              <div class="small-muted">Provably-fair demo</div>
              <div class="small-muted">Click "New Server Seed" to change server seed (demo only)</div>
            </div>
            <div>
              <button class="btn ghost" id="newSeedBtn">New Server Seed</button>
              <button class="btn" id="revealSeedBtn">Reveal Last Server Seed</button>
            </div>
          </div>
          <div style="margin-top:8px">
            <div class="small-muted">Last server seed (SHA256):</div>
            <div id="serverHash" class="small-muted mono">‚Äî</div>
            <div class="small-muted" style="margin-top:6px">Last revealed seed:</div>
            <div id="serverReveal" class="small-muted mono">‚Äî</div>
          </div>
        </div>

        <div class="card" style="width:320px">
          <div class="small-muted">Round ticker / recent wins</div>
          <div class="ticker" id="ticker"></div>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div>
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <div>
            <div class="small-muted">Leaderboard</div>
            <div id="leaderboard" style="margin-top:8px"></div>
          </div>
          <div>
            <div class="small-muted">Your stats</div>
            <div class="small-muted" id="stats">Wins:0 Losses:0</div>
          </div>
        </div>

        <hr style="margin:12px 0; border:none; height:1px; background:rgba(255,255,255,0.02)">

        <div class="small-muted">Settings</div>
        <div style="margin-top:8px; display:flex; flex-direction:column; gap:8px">
          <label><input id="soundToggle" type="checkbox" checked /> Sound (demo)</label>
          <label><input id="reduceMotion" type="checkbox" /> Reduce motion</label>
        </div>
      </div>
    </div>
  </div>

  <footer>
    This is a demo. No real money. Everything runs locally in your browser. Modify branding and initial balance in the file comments.
  </footer>
</div>

<script>
/* -------------------------
  RainClone ‚Äî Client-side Casino Demo
  - All logic runs in-browser. No real money.
  - Change initialBalance below if you want.
--------------------------*/
(() => {
  const initialBalance = 2000; // change default starting RC here
  // -- state
  let state = {
    balance: 0,
    history: [],
    leaderboard: [],
    stats: {wins:0, losses:0},
    provable: { serverSeed: null, serverHash: null, lastReveal: null },
    crash: { running:false, multiplier:1.0, roundId: null, lastRound: null },
    auto: { enabled:false, target:2.0, roundsLeft:0 }
  };

  // ---------- utilities ----------
  const $ = id => document.getElementById(id);
  const fmt = n => Math.round(n*100)/100;
  const rand = (min, max) => Math.floor(Math.random()*(max-min+1))+min;
  const sha256hex = async (s) => {
    const enc = new TextEncoder().encode(s);
    const hash = await crypto.subtle.digest('SHA-256', enc);
    return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2,'0')).join('');
  };

  // ---------- persistence ----------
  function saveLocal() {
    localStorage.setItem('rainclone_state', JSON.stringify({
      balance: state.balance, history: state.history.slice(0,100), leaderboard: state.leaderboard, provable: state.provable, stats: state.stats
    }));
  }
  function loadLocal(){
    const raw = localStorage.getItem('rainclone_state');
    if(raw) {
      try{
        const d = JSON.parse(raw);
        state.balance = d.balance ?? initialBalance;
        state.history = d.history ?? [];
        state.leaderboard = d.leaderboard ?? [];
        state.provable = d.provable ?? state.provable;
        state.stats = d.stats ?? state.stats;
      }catch(e){ state.balance = initialBalance; }
    }else state.balance = initialBalance;
    updateAll();
  }

  // ---------- UI helpers ----------
  function updateAll(){
    $('balanceDisplay').innerText = `${fmt(state.balance)} `;
    $('headerBalance').innerText = `${fmt(state.balance)} RC`;
    renderHistory();
    renderLeaderboard();
    $('stats').innerText = `Wins:${state.stats.wins} Losses:${state.stats.losses}`;
    $('serverHash').innerText = state.provable.serverHash || '‚Äî';
    $('serverReveal').innerText = state.provable.lastReveal || '‚Äî';
  }

  function pushHistory(entry){
    state.history.unshift(entry);
    if(state.history.length>200) state.history.pop();
    renderHistory();
    saveLocal();
    // push to ticker and leaderboard
    const ticker = $('ticker');
    const el = document.createElement('div'); el.className='win-row';
    el.innerHTML = `<div style="font-weight:700">${entry.game}</div><div class="small-muted">${entry.outcome}</div><div class="${entry.win? 'win-green' : ''}">${entry.amount>0? '+'+fmt(entry.amount): fmt(entry.amount)}</div>`;
    ticker.prepend(el);
    // leaderboard update simple
    if(entry.win){
      state.leaderboard.push({name: 'Player', amt: entry.amount});
      state.leaderboard.sort((a,b)=>b.amt-a.amt);
      state.leaderboard = state.leaderboard.slice(0,10);
      renderLeaderboard();
    }
  }

  function renderHistory(){
    const h = $('history'); h.innerHTML = '';
    state.history.slice(0,12).forEach(it=>{
      const r = document.createElement('div'); r.style.padding='8px'; r.style.borderBottom='1px solid rgba(255,255,255,0.02)';
      r.innerHTML = `<div style="display:flex;justify-content:space-between"><div style="font-weight:700">${it.game}</div><div class="small-muted">${it.time}</div></div><div class="small-muted">${it.outcome} <span style="float:right">${it.amount>0? '+'+fmt(it.amount): fmt(it.amount)}</span></div>`;
      h.appendChild(r);
    });
  }

  function renderLeaderboard(){
    const el = $('leaderboard'); el.innerHTML='';
    if(state.leaderboard.length===0){ el.innerHTML = '<div class="small-muted">No big wins yet</div>'; return; }
    state.leaderboard.forEach((l,i)=>{
      const row = document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.padding='6px 0';
      row.innerHTML = `<div>${i+1}. ${l.name}</div><div class="small-muted">${fmt(l.amt)}</div>`;
      el.appendChild(row);
    });
  }

  // ---------- Provably-fair demo ----------
  async function newServerSeed(){
    const seed = Math.random().toString(36).slice(2)+Date.now().toString(36);
    const h = await sha256hex(seed);
    state.provable.serverSeed = seed;
    state.provable.serverHash = h;
    saveLocal(); updateAll();
  }
  async function revealServerSeed(){
    if(!state.provable.serverSeed){ alert('No server seed generated yet.'); return; }
    state.provable.lastReveal = state.provable.serverSeed;
    // show simple verify example: combine server seed + client seed to derive a random number
    saveLocal(); updateAll();
    alert('Revealed server seed (demo):\n'+state.provable.serverSeed + '\n\nHash: ' + state.provable.serverHash);
  }

  // ---------- Game: Crash ----------
  const crashCanvas = $('crashCanvas');
  const crashCtx = crashCanvas.getContext('2d');
  function resizeCrashCanvas(){ crashCanvas.width = crashCanvas.clientWidth * devicePixelRatio; crashCanvas.height = crashCanvas.clientHeight * devicePixelRatio; crashCtx.scale(devicePixelRatio, devicePixelRatio); }
  window.addEventListener('resize', resizeCrashCanvas);

  let crashAnimId = null;
  function startCrashRound(bet, autoCashout){
    if(state.crash.running) return;
    if(bet>state.balance){ alert('Not enough balance'); return; }
    state.balance -= bet; updateAll(); saveLocal();

    // create deterministicish random crash point using server seed + round id
    const roundId = Math.random().toString(36).substr(2,8);
    state.crash.roundId = roundId; $('roundId').innerText = roundId;
    state.crash.running = true;
    state.crash.multiplier = 1.0;
    $('crashStatus').innerText = 'Running';
    $('multText').innerText = '1.00x';

    // generate crashPoint with bias: common low crashes, rare big ones
    const r = Math.random();
    const crashPoint = Math.max(1.0, Math.round((1 + (Math.pow(1.0 / (1 - r), 0.6) * 10)) * 100)/100); // skewed heavy tail
    // To make some rounds crash early:
    const early = Math.random() < 0.12;
    const finalCrash = early ? (1 + Math.random()*0.3) : crashPoint;

    let start = null; function frame(ts){
      if(!start) start = ts;
      const t = (ts - start)/1000;
      // multiplier growth (exponential feeling)
      state.crash.multiplier = Math.max(1.0, 1 + Math.pow(t*0.8, 1.7));
      // draw graph
      drawCrash();
      $('multText').innerText = state.crash.multiplier.toFixed(2) + 'x';

      // auto-cashout
      if(autoCashout && state.crash.multiplier >= autoCashout){
        // win
        const win = Math.round((bet * (autoCashout-1)) * 100) / 100;
        state.balance += bet + win;
        pushHistory({game:'Crash', outcome:'Auto-cashed out', amount: +fmt(win), time: new Date().toLocaleTimeString(), win:true});
        state.crash.running = false;
        $('crashStatus').innerText = 'Finished (autocashed)';
        updateAll(); saveLocal();
        return cancelAnimationFrame(crashAnimId);
      }

      // decide crash moment by time > threshold derived from finalCrash
      if(state.crash.multiplier >= finalCrash){
        // crashed
        state.crash.running = false;
        $('crashStatus').innerText = 'Crashed at ' + finalCrash.toFixed(2) + 'x';
        pushHistory({game:'Crash', outcome:'Crashed', amount: -bet, time: new Date().toLocaleTimeString(), win:false});
        updateAll(); saveLocal();
        return cancelAnimationFrame(crashAnimId);
      }
      crashAnimId = requestAnimationFrame(frame);
    }
    crashAnimId = requestAnimationFrame(frame);
  }

  function cashoutCrash(){
    if(!state.crash.running){ return alert('No running crash round'); }
    const bet = parseFloat($('crashBet').value);
    const received = (state.crash.multiplier-1) * bet;
    const gain = Math.round(received*100)/100;
    state.balance += bet + gain; // return bet + profit
    pushHistory({game:'Crash', outcome:'Manual cashout @'+state.crash.multiplier.toFixed(2)+'x', amount: +fmt(gain), time: new Date().toLocaleTimeString(), win:true});
    state.crash.running = false;
    $('crashStatus').innerText = 'Finished (cashed)';
    updateAll(); saveLocal();
    if(crashAnimId) cancelAnimationFrame(crashAnimId);
  }

  // simple graph draw
  function drawCrash(){
    const w = crashCanvas.clientWidth; const h = crashCanvas.clientHeight; crashCtx.clearRect(0,0,w,h);
    // background grid
    crashCtx.fillStyle = 'rgba(255,255,255,0.02)'; crashCtx.fillRect(0,0,w,h);
    // multiplier bar
    const m = Math.min(10, state.crash.multiplier);
    const barH = (m/10) * h;
    crashCtx.fillStyle = 'linear-gradient(180deg,#6ad1ff,#f0c95f)';
    crashCtx.fillStyle = 'rgba(106,209,255,0.12)';
    crashCtx.fillRect(0, h - barH, w * 0.6, barH);
    // moving marker
    crashCtx.fillStyle = 'rgba(106,209,255,0.9)';
    crashCtx.beginPath(); crashCtx.arc(Math.min(w-10, state.crash.multiplier*30), h - barH - 6, 6, 0, Math.PI*2); crashCtx.fill();
  }

  // ---------- Game: Dice ----------
  function rollDice(){
    const bet = parseFloat($('diceBet').value);
    const pick = parseInt($('dicePick').value,10);
    if(bet>state.balance){ alert('Not enough balance'); return; }
    state.balance -= bet; updateAll();
    const roll = rand(1,6);
    let win=false; let profit=0;
    if(pick===6){
      if(roll===6){ win=true; profit = bet*5; }
    } else {
      if(roll>=pick){ win=true; profit = bet*(6/(6-(pick-1))) - bet; /* simplified odds */ }
    }
    if(win){
      state.balance += bet + profit;
      pushHistory({game:'Dice', outcome:`Rolled ${roll} ‚Äî WIN`, amount:+fmt(profit), time: new Date().toLocaleTimeString(), win:true});
      state.stats.wins += 1;
    } else {
      pushHistory({game:'Dice', outcome:`Rolled ${roll} ‚Äî LOSE`, amount:-bet, time: new Date().toLocaleTimeString(), win:false});
      state.stats.losses += 1;
    }
    updateAll(); saveLocal();
    $('diceResult').innerText = `Rolled: ${roll} ‚Äî ${win ? 'WIN' : 'LOSE'} ${win? ('+'+fmt(profit)) : ('-'+fmt(bet))}`;
  }

  // ---------- Game: Mines ----------
  let minesState = { grid: [], bombs:new Set(), opened:new Set(), currentBet:0, multiplier:1.0, running:false };
  function startMines(){
    const bet = parseFloat($('minesBet').value);
    const bombs = parseInt($('bombCount').value,10);
    if(bet>state.balance){ alert('Not enough balance'); return; }
    state.balance -= bet; updateAll();
    minesState.currentBet = bet; minesState.opened = new Set(); minesState.bombs = new Set();
    minesState.running = true;
    // generate bombs
    while(minesState.bombs.size < bombs){
      minesState.bombs.add(rand(0,35)); // 6x6 grid: 0..35
    }
    // update grid UI
    const grid = $('minesGrid'); grid.innerHTML='';
    for(let i=0;i<36;i++){
      const cell = document.createElement('div'); cell.className='mine-cell'; cell.dataset.idx=i;
      cell.innerText = '';
      cell.addEventListener('click', ()=> openMineCell(i, cell));
      grid.appendChild(cell);
    }
  }

  function openMineCell(idx, el){
    if(!minesState.running) return;
    if(minesState.opened.has(idx)) return;
    if(minesState.bombs.has(idx)){
      // boom - lose bet
      el.classList.add('mine-open'); el.innerText='üí£';
      minesState.running=false;
      pushHistory({game:'Mines', outcome:'Hit bomb', amount:-minesState.currentBet, time:new Date().toLocaleTimeString(), win:false});
      state.stats.losses += 1;
      updateAll(); saveLocal();
      return;
    } else {
      minesState.opened.add(idx);
      el.classList.add('mine-open'); el.innerText='‚Ä¢';
      // multiplier grows with safely opened cells
      const opened = minesState.opened.size;
      const mul = 1 + (opened * 0.15);
      minesState.multiplier = mul;
      // if user wants, they can press Cashout to take current multiplier
    }
  }

  function cashoutMines(){
    if(!minesState.running){ alert('No active mines round'); return; }
    const profit = Math.round(minesState.currentBet * (minesState.multiplier-1) * 100)/100;
    state.balance += minesState.currentBet + profit;
    pushHistory({game:'Mines', outcome:`Cashed out x${minesState.multiplier.toFixed(2)}`, amount:+fmt(profit), time:new Date().toLocaleTimeString(), win:true});
    minesState.running=false;
    state.stats.wins += 1;
    updateAll(); saveLocal();
  }

  // ---------- Game: Slots ----------
  const symbols = ['üçí','üçã','üîî','‚≠ê','7Ô∏è‚É£'];
  function spinSlots(){
    const bet = parseFloat($('slotsBet').value);
    if(bet>state.balance){ alert('Not enough balance'); return; }
    state.balance -= bet; updateAll();
    // animate reels (simple)
    const r1 = $('r1'), r2 = $('r2'), r3 = $('r3');
    r1.classList.add('spin'); r2.classList.add('spin'); r3.classList.add('spin');
    setTimeout(()=>{ r1.classList.remove('spin'); r1.innerText = symbols[rand(0,symbols.length-1)]; }, 220);
    setTimeout(()=>{ r2.classList.remove('spin'); r2.innerText = symbols[rand(0,symbols.length-1)]; }, 360);
    setTimeout(()=>{ r3.classList.remove('spin'); r3.innerText = symbols[rand(0,symbols.length-1)]; evaluateSlots(bet); }, 520);
  }
  function evaluateSlots(bet){
    const a = $('r1').innerText, b = $('r2').innerText, c = $('r3').innerText;
    let profit = 0, outcome='Lose';
    if(a===b && b===c){
      // 3 match ‚Äî big win
      const mult = a==='7Ô∏è‚É£' ? 50 : 10;
      profit = bet * mult;
      outcome = 'Jackpot';
    } else if (a===b || b===c || a===c){
      profit = bet * 2; outcome = 'Small win';
    }
    if(profit>0){
      state.balance += bet + profit;
      pushHistory({game:'Slots', outcome: outcome, amount:+fmt(profit), time:new Date().toLocaleTimeString(), win:true});
      state.stats.wins += 1;
      $('slotsResult').innerText = `${outcome}! +${fmt(profit)}`;
    } else {
      pushHistory({game:'Slots', outcome:'Lose', amount:-bet, time:new Date().toLocaleTimeString(), win:false});
      state.stats.losses += 1;
      $('slotsResult').innerText = 'No match ‚Äî try again.';
    }
    updateAll(); saveLocal();
  }

  // ---------- Auto-bet loop ----------
  let autoLoopActive = false;
  async function runAutoBet(){
    if(autoLoopActive) return;
    autoLoopActive = true;
    const rounds = parseInt($('autoRounds').value,10) || 1;
    state.auto.roundsLeft = rounds;
    const target = parseFloat($('autoTarget').value) || 2.0;
    const bet = parseFloat($('quickBet').value) || 10;
    while(state.auto.roundsLeft > 0 && $('autoToggle').checked && state.balance >= bet){
      // for demo, auto runs crash with auto cashout if reached
      startCrashRound(bet, target);
      // wait until the crash stops
      await new Promise(res => {
        const iv = setInterval(()=>{
          if(!state.crash.running){
            clearInterval(iv);
            res();
          }
        }, 200);
      });
      state.auto.roundsLeft--;
      // small wait between rounds
      await new Promise(r=>setTimeout(r, 350));
    }
    autoLoopActive = false;
  }

  // ---------- Bind UI ----------
  function bind(){
    // tabs
    document.querySelectorAll('.tab').forEach(t=>{
      t.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        const g = t.dataset.game || t.getAttribute('data-game');
        document.querySelectorAll('#gameArea > div').forEach(d=>d.style.display='none');
        $(`${g}Game`).style.display='block';
      });
    });

    $('placeBetCrash').addEventListener('click', ()=> {
      const bet = parseFloat($('crashBet').value);
      const cash = parseFloat($('cashoutAt').value) || null;
      startCrashRound(bet, cash);
    });
    $('cashoutBtn').addEventListener('click', cashoutCrash);
    $('diceRoll').addEventListener('click', rollDice);
    $('startMines').addEventListener('click', startMines);
    $('cashoutMines').addEventListener('click', cashoutMines);
    $('spinSlots').addEventListener('click', spinSlots);
    $('addFunds').addEventListener('click', ()=>{ state.balance += 1000; updateAll(); saveLocal(); });
    $('resetBtn').addEventListener('click', ()=>{ if(confirm('Reset demo state?')){ localStorage.removeItem('rainclone_state'); location.reload(); }});
    $('saveBtn').addEventListener('click', ()=>{ saveLocal(); alert('Saved to localStorage.'); });
    $('newSeedBtn').addEventListener('click', ()=> newServerSeed());
    $('revealSeedBtn').addEventListener('click', ()=> revealServerSeed());
    $('autoToggle').addEventListener('change', ()=> { if($('autoToggle').checked) runAutoBet(); });
    $('quickBet').addEventListener('change', ()=> {});
    $('autoTarget').addEventListener('change', ()=> state.auto.target = parseFloat($('autoTarget').value));
    $('autoRounds').addEventListener('change', ()=> {});
    $('soundToggle').addEventListener('change', ()=> {});
    // dice default
    $('dicePick').value = '4';
  }

  // ---------- initialize ----------
  async function init(){
    bind();
    resizeCrashCanvas();
    // create initial server seed
    if(!state.provable.serverHash) await newServerSeed();
    loadLocal();
    updateAll();
    // wire reveal button
  }
  init().catch(e=>console.error(e));

  // save state on unload
  window.addEventListener('beforeunload', saveLocal);

})();
</script>
</body>
</html>
