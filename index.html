<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SpaceMeteor ‚Äî Full Casino (Demo)</title>
<style>
  :root{
    --bg:#04050a;
    --panel:#0c1320;
    --muted:#9aa7b0;
    --accent:#6fe6ff;
    --accent-2:#b06bff;
    --gold:#ffd66b;
    --radius:14px;
    --glass: rgba(255,255,255,0.04);
    --ease:cubic-bezier(.2,.9,.25,1);
    --ui-scale:1;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:
    radial-gradient(900px 360px at 8% 8%, rgba(111,230,255,0.04), transparent),
    linear-gradient(180deg,#04050a,#071025);
    color:#e6f6fb;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    -webkit-font-smoothing:antialiased}
  html{transform-origin:0 0; transform:scale(var(--ui-scale));}

  header{display:flex;justify-content:space-between;align-items:center;gap:16px;
    padding:14px 16px;margin:14px auto;max-width:1180px;border-radius:14px;
    border:1px solid rgba(255,255,255,0.06);
    background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);}
  .logo{width:56px;height:56px;border-radius:12px;display:grid;place-items:center;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));font-weight:900}
  .muted{color:var(--muted)}
  .btn{padding:10px 14px;border-radius:12px;border:none;cursor:pointer;
    font-weight:800;background:linear-gradient(180deg,var(--accent),rgba(111,230,255,.85));color:#052b2f;
    transition:transform .15s var(--ease); }
  .btn:hover{transform:translateY(-2px)}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.08);color:var(--muted)}
  .btn.warn{background:linear-gradient(180deg,#ff9a6f,#ff6b6b)}
  input,select{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.08);color:#eef;
    padding:10px;border-radius:10px;outline:none;min-width:90px}

  .app{max-width:1180px;margin:0 auto 24px;display:grid;grid-template-columns:230px 1fr;gap:16px;padding:0 12px}
  aside{height:calc(100vh - 150px);overflow:auto;border-radius:14px;padding:14px;
    border:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg, rgba(255,255,255,.02), transparent)}
  .wallet .amount{font-weight:900;color:var(--gold);font-size:22px}
  .game-list{margin-top:10px;display:flex;flex-direction:column;gap:8px}
  .game-btn{display:flex;gap:10px;align-items:center;justify-content:flex-start;padding:10px 12px;border-radius:12px;
    border:1px solid rgba(255,255,255,.06);background:transparent;color:#cfe;cursor:pointer;transition:all .18s var(--ease)}
  .game-btn:hover{transform:translateY(-2px)}
  .game-btn.active{background:linear-gradient(90deg, rgba(111,230,255,.08), rgba(176,107,255,.05));color:var(--accent)}

  main{border-radius:14px;border:1px solid rgba(255,255,255,.06);
    background:linear-gradient(180deg, rgba(255,255,255,.02), transparent);padding:16px;min-height:720px}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
  .card{padding:16px;border-radius:14px;border:1px solid rgba(255,255,255,.06);
    background:linear-gradient(180deg, rgba(255,255,255,.02), transparent);cursor:pointer;
    transition:transform .18s var(--ease), box-shadow .18s var(--ease)}
  .card:hover{transform:translateY(-8px);box-shadow:0 30px 60px rgba(0,0,0,.55)}

  .focus{display:flex;gap:16px;align-items:flex-start}
  .main-game{flex:1;min-height:560px;border-radius:14px;border:1px solid rgba(255,255,255,.06);
    background:linear-gradient(180deg, rgba(255,255,255,.02), transparent);padding:16px}
  .side{width:280px;display:flex;flex-direction:column;gap:12px}

  .hr{height:1px;background:rgba(255,255,255,.08);margin:10px 0}

  .flex{display:flex;gap:8px;align-items:center}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .spacer{flex:1}

  /* Games */
  .crash-svg{width:100%;height:320px;border-radius:12px;background:rgba(255,255,255,.03)}
  .slots-row{display:flex;gap:12px;justify-content:center;margin-top:12px}
  .reel{width:140px;height:180px;border-radius:12px;background:rgba(255,255,255,.03);display:grid;place-items:center;font-size:64px;transition:transform .5s var(--ease)}
  .reel.stopping{transform:translateY(-6px) scale(1.02)}

  .mines-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:8px}
  .mine-cell{height:64px;border-radius:8px;background:rgba(255,255,255,0.03);display:grid;place-items:center;font-weight:800;color:#abd;cursor:pointer;transition:all .14s var(--ease)}
  .mine-open{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));color:#fff;transform:translateY(-4px)}

  .plinko{display:grid;grid-template-columns:repeat(13,1fr);gap:6px;justify-items:center;align-items:center;margin:12px 0}
  .peg{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.35)}
  .plinko-row{display:grid;grid-template-columns:repeat(var(--cols),1fr);gap:14px;width:100%}
  .plinko-ball{width:16px;height:16px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 0 16px rgba(176,107,255,.6)}

  .cards{display:flex;gap:10px;align-items:center}
  .cardUI{width:70px;height:100px;border-radius:10px;display:grid;place-items:center;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);font-weight:900}

  .keno-grid{display:grid;grid-template-columns:repeat(10,1fr);gap:6px}
  .keno-cell{padding:8px;border-radius:8px;text-align:center;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.02);cursor:pointer}
  .keno-cell.sel{background:linear-gradient(180deg,var(--accent),rgba(111,230,255,.8));color:#072;font-weight:900}
  .keno-cell.hit{outline:2px solid #7eff9e}

  .tower-row{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
  .tower-cell{height:54px;border-radius:8px;background:rgba(255,255,255,.03);display:grid;place-items:center;cursor:pointer}
  .tower-cell.safe{background:rgba(127,255,158,.15)}
  .tower-cell.bomb{background:rgba(255,107,107,.18)}

  .wheel-wrap{display:grid;place-items:center;margin-top:12px}
  .wheel{width:320px;height:320px;border-radius:50%;border:8px solid rgba(255,255,255,.1);position:relative;overflow:hidden}
  .wheel .seg{position:absolute;inset:0;display:grid;place-items:center;font-weight:900}
  .pointer{width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid var(--gold);margin-top:6px}

  @media (max-width:1050px){
    .app{grid-template-columns:1fr}
    aside{height:auto}
    .focus{flex-direction:column}
    .side{width:100%}
    .grid{grid-template-columns:repeat(2,1fr)}
  }
</style>
</head>
<body>
<header>
  <div class="flex">
    <div class="logo">‚òÑÔ∏è SM</div>
    <div>
      <div style="font-weight:900">SpaceMeteor ‚Äî Full Casino (Demo)</div>
      <div class="muted">All client-side ‚Ä¢ No real money</div>
    </div>
  </div>
  <div class="row">
    <div class="muted">Balance</div>
    <div id="topBalance" style="font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,'Roboto Mono';font-weight:900;color:var(--gold)">0 SM</div>
    <div class="hr" style="width:1px;height:26px"></div>
    <label class="muted">UI scale</label><input id="uiScale" type="range" min="0.9" max="1.2" step="0.05" value="1">
    <button class="btn ghost" id="focusToggle">Focus</button>
    <button class="btn" id="helpBtn">Tour</button>
  </div>
</header>

<div class="app">
  <aside>
    <div class="wallet">
      <div class="muted">Wallet</div>
      <div class="amount" id="walletAmount">0 SM</div>
      <div class="row" style="margin-top:8px">
        <input id="quickAdd" type="number" value="500">
        <button class="btn ghost" id="addBtn">Add</button>
        <button class="btn ghost" id="undoAddBtn">Undo</button>
      </div>
    </div>

    <div class="hr"></div>
    <div class="muted">Games</div>
    <div class="game-list" role="tablist" aria-label="Game list">
      <button class="game-btn active" data-game="home">üè† Home</button>
      <button class="game-btn" data-game="crash">üìà Crash</button>
      <button class="game-btn" data-game="dice">üé≤ Dice</button>
      <button class="game-btn" data-game="mines">üí£ Mines</button>
      <button class="game-btn" data-game="slots">üé∞ Slots</button>
      <button class="game-btn" data-game="plinko">üü£ Plinko</button>
      <button class="game-btn" data-game="limbo">üöÄ Limbo</button>
      <button class="game-btn" data-game="blackjack">üÉè Blackjack</button>
      <button class="game-btn" data-game="baccarat">üÉ† Baccarat</button>
      <button class="game-btn" data-game="keno">üé± Keno</button>
      <button class="game-btn" data-game="tower">üóº Tower</button>
      <button class="game-btn" data-game="wheel">üé° Multiplier Wheel</button>
    </div>
  </aside>

  <main id="main">
    <!-- Lobby -->
    <section id="homeView">
      <div class="row" style="justify-content:space-between">
        <div>
          <h2 style="margin:0">Welcome to SpaceMeteor</h2>
          <div class="muted">Pick a game. The layout focuses on the current game for a smoother experience.</div>
        </div>
      </div>
      <div class="grid" style="margin-top:14px">
        <div class="card" data-open="crash"><strong>Crash</strong><div class="muted">Cash out before it explodes.</div></div>
        <div class="card" data-open="dice"><strong>Dice</strong><div class="muted">Simple, fast, clean.</div></div>
        <div class="card" data-open="mines"><strong>Mines</strong><div class="muted">Avoid bombs, cash anytime.</div></div>
        <div class="card" data-open="slots"><strong>Slots</strong><div class="muted">Staggered reel stops.</div></div>
        <div class="card" data-open="plinko"><strong>Plinko</strong><div class="muted">Drop to win multipliers.</div></div>
        <div class="card" data-open="limbo"><strong>Limbo</strong><div class="muted">Set multiplier, hope it hits.</div></div>
        <div class="card" data-open="blackjack"><strong>Blackjack</strong><div class="muted">Beat the dealer to 21.</div></div>
        <div class="card" data-open="baccarat"><strong>Baccarat</strong><div class="muted">Bet Player / Banker / Tie.</div></div>
        <div class="card" data-open="keno"><strong>Keno</strong><div class="muted">Pick numbers, draw 20.</div></div>
        <div class="card" data-open="tower"><strong>Tower</strong><div class="muted">Pick safe tiles per level.</div></div>
        <div class="card" data-open="wheel"><strong>Multiplier Wheel</strong><div class="muted">Spin & land a multiplier.</div></div>
      </div>
    </section>

    <!-- Game canvas -->
    <section id="gameView" style="display:none">
      <div class="focus">
        <div class="main-game" id="mainGame"></div>
        <div class="side">
          <div>
            <div class="muted">Round</div>
            <div id="roundLabel" style="font-weight:900;margin-top:6px">‚Äî</div>
            <div id="roundSub" class="muted" style="margin-top:6px">Status</div>
          </div>
          <div class="hr"></div>
          <div>
            <div class="muted">Quick Controls</div>
            <div class="row" style="margin-top:8px">
              <div>
                <div class="muted" style="font-size:12px">Bet</div>
                <input id="sideBet" type="number" value="150">
              </div>
              <button class="btn" id="sidePlace">Place</button>
              <button class="btn ghost" id="sideCash">Cashout</button>
            </div>
          </div>
          <div class="hr"></div>
          <button class="btn ghost" id="backLobby">‚Üê Back to Lobby</button>
        </div>
      </div>
    </section>
  </main>
</div>

<footer style="text-align:center;color:var(--muted);margin:16px 0">Demo only ‚Äî no real money. Tweak START_BALANCE in the script.</footer>

<script>
/* SpaceMeteor ‚Äî All-in-one single-file demo (no server)
   Games: Crash, Dice, Mines, Slots, Plinko, Limbo, Blackjack, Baccarat, Keno, Tower, Wheel
   Notes:
   - All RNG uses Math.random() (not cryptographic)
   - Wallet & state persist in localStorage
   - Clean separation per game; each renders into #mainGame
*/

document.addEventListener('DOMContentLoaded', () => {
  const START_BALANCE = 5000;
  const STORAGE_KEY = 'spacemeteor_full_v2';
  const $ = id => document.getElementById(id);
  const qa = sel => Array.from(document.querySelectorAll(sel));
  const now = () => new Date().toLocaleTimeString();

  let state = {
    balance: START_BALANCE,
    lastAdd: null
  };

  function loadState(){
    try{ const raw = localStorage.getItem(STORAGE_KEY); if(raw){ const s = JSON.parse(raw)||{}; state = Object.assign(state, s);} }catch(e){}
  }
  function saveState(){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }catch(e){} renderHeader(); }
  function renderHeader(){
    $('topBalance').innerText = (state.balance||0).toFixed(2) + ' SM';
    $('walletAmount').innerText = (state.balance||0).toFixed(2) + ' SM';
  }

  // Utility
  const rngInt = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
  const clamp = (v,lo,hi)=> Math.max(lo, Math.min(hi, v));
  const delay = (ms)=> new Promise(r=>setTimeout(r,ms));

  // Static bindings
  function bindStatic(){
    $('addBtn').addEventListener('click',()=>{
      const v = Math.max(0, parseFloat($('quickAdd').value)||0); if(!v) return;
      state.balance += v; state.lastAdd = v; saveState();
    });
    $('undoAddBtn').addEventListener('click',()=>{
      if(!state.lastAdd) return alert('Nothing to undo');
      state.balance -= state.lastAdd; state.lastAdd = null; saveState();
    });
    $('uiScale').addEventListener('input', e=>{
      document.documentElement.style.setProperty('--ui-scale', e.target.value);
    });
    $('helpBtn').addEventListener('click', ()=> {
      alert('SpaceMeteor quick tour:\n\n‚Äî Lobby shows all games.\n‚Äî Pick a game to focus.\n‚Äî Controls are on the right.\n‚Äî Use Back to Lobby to switch quickly.\n‚Äî Keyboard: [1..0] jump to games, Space to Place, C to Cashout where available.');
    });
    $('focusToggle').addEventListener('click', ()=>{
      const left = document.querySelector('aside');
      const app = document.querySelector('.app');
      if(left.style.display==='none'){ left.style.display='block'; app.style.gridTemplateColumns='230px 1fr'; $('focusToggle').innerText='Focus'; }
      else { left.style.display='none'; app.style.gridTemplateColumns='1fr'; $('focusToggle').innerText='Unfocus'; }
    });

    qa('.game-btn').forEach(btn=>{
      btn.addEventListener('click', ()=> { qa('.game-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); open(btn.dataset.game); });
    });
    qa('.card[data-open]').forEach(card=> card.addEventListener('click', ()=>{
      const g = card.dataset.open; const btn = qa(`.game-btn[data-game="${g}"]`)[0]; qa('.game-btn').forEach(b=>b.classList.remove('active')); btn && btn.classList.add('active'); open(g);
    }));
    $('backLobby').addEventListener('click', ()=> open('home'));

    // Hotkeys
    window.addEventListener('keydown', (e)=>{
      if(e.key===' '){ e.preventDefault(); $('sidePlace').click(); }
      if(e.key.toLowerCase()==='c'){ $('sideCash').click(); }
      const map = ['home','crash','dice','mines','slots','plinko','limbo','blackjack','baccarat','keno','tower','wheel'];
      if(/^[0-9]$/.test(e.key)){ const i = Number(e.key); const g = map[i] || null; if(g){ const b = qa(`.game-btn[data-game="${g}"]`)[0]; b && b.click(); } }
    });
  }

  function setRound(title, sub=''){
    $('roundLabel').innerText = title;
    $('roundSub').innerText = sub;
  }

  function showLobby(show){
    $('homeView').style.display = show ? 'block' : 'none';
    $('gameView').style.display = show ? 'none' : 'block';
  }

  function open(name){
    if(name==='home'){ showLobby(true); return; }
    showLobby(false);
    const main = $('mainGame'); main.innerHTML='';
    setRound(name[0].toUpperCase()+name.slice(1),'Ready');
    stopAnims();
    // inject game
    ({
      crash: renderCrash,
      dice: renderDice,
      mines: renderMines,
      slots: renderSlots,
      plinko: renderPlinko,
      limbo: renderLimbo,
      blackjack: renderBlackjack,
      baccarat: renderBaccarat,
      keno: renderKeno,
      tower: renderTower,
      wheel: renderWheel
    }[name]||(()=>{main.innerHTML='<div>Unknown game</div>'}))();
  }

  // =========================================================
  // Crash
  // =========================================================
  const anims = new Set();
  function trackRAF(id){ if(id) anims.add(id); }
  function stopAnims(){ for(const id of anims) cancelAnimationFrame(id); anims.clear(); }

  const crashState = { running:false, bet:0, mult:1, crashAt:0, raf:null };
  function deterministicCrash(seed){
    let h = 2166136261>>>0; for(let i=0;i<seed.length;i++) h = Math.imul(h ^ seed.charCodeAt(i), 16777619)>>>0;
    const r = (h%100000)/100000; const v = Math.max(1, Math.round((1 + Math.pow(1/(1-r+0.0001), 0.6))*100)/100);
    return Math.min(200, v);
  }

  function renderCrash(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Crash</h2>
      <svg id="crashSvg" class="crash-svg" viewBox="0 0 1000 320" preserveAspectRatio="none"></svg>
      <div class="row">
        <div class="muted">Bet</div><input id="crashBet" type="number" value="200" style="width:120px">
        <div class="muted">Auto</div><input id="crashAuto" type="number" value="2.00" step="0.01" style="width:110px">
        <div class="spacer"></div>
        <button class="btn" id="startCrash">Place & Start</button>
        <button class="btn ghost" id="cashCrash">Cashout</button>
      </div>
      <div id="crashStatus" class="muted">Status: idle</div>
    `;
    drawCrashSVG([]);

    $('startCrash').onclick = ()=>{
      const bet = +$('crashBet').value||0; const auto = parseFloat($('crashAuto').value)||null;
      if(bet<=0) return alert('Enter bet'); if(bet>state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState();
      const seed = Date.now().toString(36)+Math.random().toString(36).slice(2);
      crashState.running=true; crashState.bet=bet; crashState.mult=1; crashState.crashAt = deterministicCrash(seed);
      $('crashStatus').innerText = 'Running...';
      let last = performance.now();
      const loop = (t)=>{
        const dt = (t-last)/1000; last=t;
        crashState.mult += dt*(0.9 + Math.log(crashState.mult+1)*0.55);
        $('crashStatus').innerText = `Running ‚Äî ${crashState.mult.toFixed(2)}x`;
        if(auto && crashState.mult>=auto){
          const profit = Math.round((auto-1)*bet*100)/100;
          state.balance += bet + profit; saveState();
          $('crashStatus').innerText = `Auto cashout @${auto.toFixed(2)}x (+${profit.toFixed(2)} SM)`;
          crashState.running=false; return;
        }
        if(crashState.mult>=crashState.crashAt){
          $('crashStatus').innerText = `Crashed @${crashState.crashAt.toFixed(2)}x ‚Äî lost ${bet} SM`;
          crashState.running=false; return;
        }
        const id = requestAnimationFrame(loop); trackRAF(id);
      };
      const id = requestAnimationFrame(loop); trackRAF(id);
    };
    $('cashCrash').onclick = ()=>{
      if(!crashState.running) return alert('No active crash');
      const p = Math.round((crashState.mult-1)*crashState.bet*100)/100;
      state.balance += crashState.bet + p; saveState();
      $('crashStatus').innerText = `Manual cashout @${crashState.mult.toFixed(2)}x (+${p.toFixed(2)} SM)`;
      crashState.running=false;
    };
  }

  function drawCrashSVG(hist){
    const svg = $('crashSvg'); if(!svg) return;
    svg.innerHTML='';
    const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
    rect.setAttribute('width','100%');rect.setAttribute('height','100%');rect.setAttribute('fill','rgba(255,255,255,.02)'); svg.appendChild(rect);
    if(hist.length>1){
      const max = Math.max(...hist, 5);
      const points = hist.map((m,i)=>`${Math.round(i*(1000/(hist.length-1)))},${Math.round(300 - (Math.min(m,max)/max)*260)}`).join(' ');
      const poly = document.createElementNS('http://www.w3.org/2000/svg','polyline');
      poly.setAttribute('points',points); poly.setAttribute('fill','none'); poly.setAttribute('stroke','url(#g1)'); poly.setAttribute('stroke-width','3');
      const defs = document.createElementNS('http://www.w3.org/2000/svg','defs');
      const grad = document.createElementNS('http://www.w3.org/2000/svg','linearGradient'); grad.setAttribute('id','g1'); grad.setAttribute('x1','0%'); grad.setAttribute('x2','100%');
      const s1 = document.createElementNS('http://www.w3.org/2000/svg','stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color',getComputedStyle(document.documentElement).getPropertyValue('--accent').trim());
      const s2 = document.createElementNS('http://www.w3.org/2000/svg','stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color',getComputedStyle(document.documentElement).getPropertyValue('--accent-2').trim());
      grad.appendChild(s1);grad.appendChild(s2);defs.appendChild(grad);svg.appendChild(defs);svg.appendChild(poly);
    }
  }

  // =========================================================
  // Dice
  // =========================================================
  function renderDice(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Dice</h2>
      <div class="row" style="margin-top:8px">
        <div class="muted">Target</div>
        <select id="dicePick"><option value="4">‚â• 4</option><option value="5">‚â• 5</option><option value="6">= 6</option></select>
        <div class="muted">Bet</div><input id="diceBet" type="number" value="150" style="width:120px">
        <div class="spacer"></div>
        <button class="btn" id="diceRoll">Roll</button>
      </div>
      <div style="text-align:center;margin-top:12px">
        <div class="muted">Result</div>
        <div id="diceFace" style="font-size:120px;padding:18px;border-radius:14px;background:rgba(255,255,255,.03)">‚Äî</div>
        <div id="diceMsg" class="muted" style="margin-top:6px">Roll to play</div>
      </div>
    `;
    $('diceRoll').onclick = ()=>{
      const pick = +$('dicePick').value;
      const bet = +$('diceBet').value||0;
      if(bet<=0) return alert('Enter bet'); if(bet>state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState();
      const roll = rngInt(1,6); $('diceFace').innerText = roll;
      let win=false, profit=0;
      if(pick===6){ if(roll===6){ win=true; profit=bet*5; } }
      else { if(roll>=pick){ win=true; profit = Math.round((bet * (6/(6-(pick-1)) - 1))*100)/100; } }
      if(win){ state.balance += bet + profit; saveState(); $('diceMsg').innerText = `WIN +${profit.toFixed(2)} SM`; }
      else { $('diceMsg').innerText = `LOSE -${bet.toFixed(2)} SM`; }
    };
  }

  // =========================================================
  // Mines
  // =========================================================
  function renderMines(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Mines</h2>
      <div class="row" style="margin-top:8px">
        <div><div class="muted" style="font-size:12px">Bombs</div><select id="bombs"><option>3</option><option selected>5</option><option>8</option></select></div>
        <div><div class="muted" style="font-size:12px">Bet</div><input id="minesBet" type="number" value="150" style="width:120px"></div>
        <div class="spacer"></div>
        <button class="btn" id="startMines">Start</button>
        <button class="btn ghost" id="cashMines">Cashout</button>
      </div>
      <div id="minesGrid" class="mines-grid" style="margin-top:12px"></div>
      <div id="minesMsg" class="muted" style="margin-top:8px"></div>
    `;
    const grid = $('minesGrid'); grid.innerHTML='';
    for(let i=0;i<48;i++){ const c=document.createElement('div'); c.className='mine-cell'; c.dataset.i=i; c.textContent='?'; grid.appendChild(c); }
    let bombs = new Set(), opened = new Set(), running=false, curBet=0;
    $('startMines').onclick = ()=>{
      const bet = +$('minesBet').value||0; if(bet<=0) return alert('Enter bet'); if(bet>state.balance) return alert('Not enough funds');
      const count = +$('bombs').value||5;
      state.balance -= bet; saveState();
      bombs.clear(); opened.clear(); running=true; curBet=bet;
      while(bombs.size<count) bombs.add(rngInt(0,47));
      grid.querySelectorAll('.mine-cell').forEach(c=>{c.classList.remove('mine-open'); c.textContent='?';});
      $('minesMsg').innerText='Round started ‚Äî open tiles.';
    };
    grid.addEventListener('click', e=>{
      const cell = e.target.closest('.mine-cell'); if(!cell||!running) return;
      const idx = +cell.dataset.i; if(opened.has(idx)) return;
      opened.add(idx);
      if(bombs.has(idx)){
        cell.classList.add('mine-open'); cell.textContent='üí£'; running=false; $('minesMsg').innerText=`Boom ‚Äî lost ${curBet} SM`;
      }else{
        cell.classList.add('mine-open'); cell.textContent='‚Ä¢';
        const mul = 1 + opened.size*0.12;
        $('minesMsg').innerText = `Safe ‚Äî x${mul.toFixed(2)} ‚Äî open more or cashout.`;
      }
    });
    $('cashMines').onclick = ()=>{
      if(!running) return alert('No active round');
      const mul = 1 + opened.size*0.12;
      const profit = Math.round(curBet*(mul-1)*100)/100;
      state.balance += curBet + profit; saveState(); running=false;
      $('minesMsg').innerText = `Cashed out +${profit.toFixed(2)} SM`;
    };
  }

  // =========================================================
  // Slots
  // =========================================================
  function renderSlots(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Slots</h2>
      <div class="slots-row">
        <div class="reel" id="r1">üçí</div>
        <div class="reel" id="r2">üçã</div>
        <div class="reel" id="r3">üîî</div>
      </div>
      <div class="row" style="margin-top:12px">
        <div class="muted">Bet</div><input id="slotsBet" type="number" value="150" style="width:120px">
        <div class="spacer"></div>
        <button class="btn" id="spinBtn">Spin</button>
        <div id="slotsMsg" class="muted">Match 3 (7Ô∏è‚É£ pays x50).</div>
      </div>
    `;
    const symbols = ['üçí','üçã','üîî','‚≠ê','7Ô∏è‚É£'];
    const r1=$('r1'),r2=$('r2'),r3=$('r3');
    let spinning=false;
    const pick=()=>symbols[rngInt(0,symbols.length-1)];
    $('spinBtn').onclick = async ()=>{
      if(spinning) return;
      const bet = +$('slotsBet').value||0; if(bet<=0) return alert('Enter bet'); if(bet>state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState(); spinning=true;
      [r1,r2,r3].forEach(el=>el.classList.add('stopping'));
      const t1=pick(), t2=pick(), t3=pick();
      await delay(240); r1.classList.remove('stopping'); r1.innerText=t1;
      await delay(180); r2.classList.remove('stopping'); r2.innerText=t2;
      await delay(200); r3.classList.remove('stopping'); r3.innerText=t3;
      let profit=0;
      if(t1===t2 && t2===t3) profit = (t1==='7Ô∏è‚É£')? bet*50 : bet*10;
      else if(t1===t2 || t2===t3 || t1===t3) profit = bet*2;
      if(profit>0){ state.balance += bet + profit; saveState(); $('slotsMsg').innerText = `Win +${profit.toFixed(2)} SM`; }
      else $('slotsMsg').innerText = `No match ‚Äî lost ${bet.toFixed(2)} SM`;
      spinning=false;
    };
  }

  // =========================================================
  // Plinko (simple grid with animated path into payout bins)
  // =========================================================
  function renderPlinko(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Plinko</h2>
      <div class="row" style="margin-top:8px">
        <div class="muted">Rows</div><select id="plRows"><option>8</option><option selected>10</option><option>12</option></select>
        <div class="muted">Bet</div><input id="plBet" type="number" value="100" style="width:120px">
        <div class="spacer"></div>
        <button class="btn" id="plDrop">Drop</button>
      </div>
      <div id="plArea" style="margin-top:12px"></div>
      <div id="plMsg" class="muted" style="margin-top:8px">Drop to play.</div>
    `;
    const area = $('plArea');
    function payoutFor(bin, rows){
      // center ‚âà 0.2x, edges ‚âà 5x ‚Äî simple curve
      const center = rows/2;
      const dist = Math.abs(bin-center);
      const maxDist = center;
      const base = 5 * Math.pow(1 - dist/maxDist, 2) + 0.2; // 0.2..5.2
      return Math.max(0.2, Math.round(base*100)/100);
    }
    $('plDrop').onclick = async ()=>{
      const rows = +$('plRows').value||10;
      const bet = +$('plBet').value||0; if(bet<=0) return alert('Enter bet'); if(bet>state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState();
      // build pegs
      area.innerHTML='';
      const cols = rows+1;
      let x = Math.floor(cols/2); // start middle
      for(let r=0;r<rows;r++){
        const row = document.createElement('div'); row.className='plinko-row'; row.style.setProperty('--cols', cols);
        for(let c=0;c<cols;c++){ const peg=document.createElement('div'); peg.className='peg'; row.appendChild(peg); }
        area.appendChild(row);
      }
      // animate ball
      const ball = document.createElement('div'); ball.className='plinko-ball'; area.appendChild(ball);
      ball.style.position='relative';
      let bin = 0;
      for(let r=0;r<rows;r++){
        const dir = Math.random()<0.5?-1:1; x = clamp(x+dir, 0, cols-1);
        bin = x;
        ball.style.left = (x*(100/(cols-1)))+'%';
        ball.style.top = (r*28)+'px';
        await delay(120);
      }
      const mult = payoutFor(bin, rows);
      const profit = Math.round(bet*(mult-1)*100)/100;
      if(mult>1){ state.balance += bet + profit; saveState(); $('plMsg').innerText = `Landed bin ${bin+1}/${cols} ‚Äî x${mult.toFixed(2)} ‚Üí +${profit.toFixed(2)} SM`; }
      else { $('plMsg').innerText = `Landed bin ${bin+1}/${cols} ‚Äî x${mult.toFixed(2)} ‚Üí -${bet.toFixed(2)} SM`; }
    };
  }

  // =========================================================
  // Limbo (choose target multiplier; win if RNG >= target)
  // =========================================================
  function renderLimbo(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Limbo</h2>
      <div class="row" style="margin-top:8px">
        <div class="muted">Target x</div><input id="limTarget" type="number" value="2.00" step="0.01" style="width:120px">
        <div class="muted">Bet</div><input id="limBet" type="number" value="100" style="width:120px">
        <div class="spacer"></div>
        <button class="btn" id="limGo">Go</button>
      </div>
      <div style="font-size:72px;text-align:center;margin-top:12px" id="limLive">‚Äî</div>
      <div id="limMsg" class="muted" style="text-align:center;margin-top:6px">Pick target; house edge baked into odds.</div>
    `;
    $('limGo').onclick = async ()=>{
      const t = Math.max(1.01, parseFloat($('limTarget').value)||2);
      const bet = +$('limBet').value||0; if(bet<=0) return alert('Enter bet'); if(bet>state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState();
      // simple biased distribution: chance of winning ‚âà 0.99/t
      const pWin = 0.99 / t;
      const win = Math.random() < pWin;
      // reveal with mini count-up
      $('limLive').innerText = '‚Ä¶';
      await delay(250);
      if(win){
        $('limLive').innerText = t.toFixed(2)+'x';
        const profit = Math.round((t-1)*bet*100)/100;
        state.balance += bet + profit; saveState();
        $('limMsg').innerText = `WIN @ ${t.toFixed(2)}x ‚Üí +${profit.toFixed(2)} SM`;
      }else{
        const shown = (Math.random()*t*0.95).toFixed(2);
        $('limLive').innerText = shown+'x';
        $('limMsg').innerText = `BUST @ ${shown}x ‚Üí -${bet.toFixed(2)} SM`;
      }
    };
  }

  // =========================================================
  // Blackjack (single deck, dealer hits soft 17)
  // =========================================================
  function renderBlackjack(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Blackjack</h2>
      <div class="row" style="margin-top:8px">
        <div class="muted">Bet</div><input id="bjBet" type="number" value="200" style="width:120px">
        <div class="spacer"></div>
        <button class="btn" id="bjDeal">Deal</button>
        <button class="btn ghost" id="bjHit" disabled>Hit</button>
        <button class="btn ghost" id="bjStand" disabled>Stand</button>
      </div>
      <div class="row" style="margin-top:10px"><div class="muted">Dealer</div><div id="bjDealer" class="cards"></div></div>
      <div class="row" style="margin-top:6px"><div class="muted">Player</div><div id="bjPlayer" class="cards"></div></div>
      <div id="bjMsg" class="muted" style="margin-top:8px"></div>
    `;
    const deck = ()=> {
      const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
      const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
      const d=[]; for(const r of ranks) for(const s of suits) d.push({r,s});
      // shuffle
      for(let i=d.length-1;i>0;i--){ const j=rngInt(0,i); [d[i],d[j]]=[d[j],d[i]]; }
      return d;
    };
    const val = (hand)=>{
      let total=0, aces=0;
      for(const c of hand){
        if(c.r==='A'){ total+=11; aces++; }
        else if(['K','Q','J'].includes(c.r)){ total+=10; }
        else total+=Number(c.r);
      }
      while(total>21 && aces>0){ total-=10; aces--; }
      return total;
    };
    const render = (div, hand, hideFirst=false)=>{
      div.innerHTML=''; hand.forEach((c,i)=>{
        const el=document.createElement('div'); el.className='cardUI';
        el.textContent = (hideFirst && i===0) ? 'üÇ†' : (c.r+c.s);
        div.appendChild(el);
      });
    };

    let D=[], dealer=[], player=[], running=false, bet=0, hideDealer=true;

    $('bjDeal').onclick = ()=>{
      bet = +$('bjBet').value||0; if(bet<=0) return alert('Enter bet'); if(bet>state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState();
      D = deck(); dealer=[D.pop(), D.pop()]; player=[D.pop(), D.pop()]; running=true; hideDealer=true;
      render($('bjDealer'), dealer, true); render($('bjPlayer'), player, false);
      $('bjHit').disabled=false; $('bjStand').disabled=false; $('bjMsg').innerText='Hit or Stand';
      // blackjack checks
      const pv = val(player), dv = val(dealer);
      if(pv===21 || dv===21){
        finish(true);
      }
    };
    $('bjHit').onclick = ()=>{
      if(!running) return; player.push(D.pop()); render($('bjPlayer'), player);
      const pv=val(player); if(pv>21) finish(true);
    };
    $('bjStand').onclick = ()=> finish(false);

    function finish(early){
      hideDealer=false; render($('bjDealer'), dealer, false);
      // dealer plays to 17 (hit soft 17)
      let dv = val(dealer);
      while(dv<17 || (dv===17 && hasAceAs11(dealer))){ dealer.push(D.pop()); dv=val(dealer); render($('bjDealer'), dealer, false); }
      const pv = val(player); dv = val(dealer);
      let outcome='';
      if(pv>21) outcome = `Player busts (${pv}) ‚Äî lose ${bet} SM`;
      else if(dv>21) { outcome = `Dealer busts (${dv}) ‚Äî WIN +${bet.toFixed(2)} SM`; state.balance += bet*2; }
      else if(pv>dv) { outcome = `You ${pv} vs Dealer ${dv} ‚Äî WIN +${bet.toFixed(2)} SM`; state.balance += bet*2; }
      else if(pv<dv) outcome = `You ${pv} vs Dealer ${dv} ‚Äî lose ${bet} SM`;
      else { outcome = `Push ${pv} ‚Äî bet returned`; state.balance += bet; }
      saveState();
      $('bjMsg').innerText = outcome;
      $('bjHit').disabled=true; $('bjStand').disabled=true; running=false;
    }
    function hasAceAs11(hand){
      // if counting one ace as 11 keeps total <= 21
      let total=0, aces=0;
      for(const c of hand){ if(c.r==='A'){aces++; total+=11;} else if(['K','Q','J'].includes(c.r)) total+=10; else total+=Number(c.r); }
      while(total>21 && aces>0){ total-=10; aces--; }
      return aces>0; // if any ace is still 11
    }
  }

  // =========================================================
  // Baccarat (simplified proper drawing rules)
  // =========================================================
  function renderBaccarat(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Baccarat</h2>
      <div class="row" style="margin-top:8px">
        <div class="muted">Bet on</div>
        <select id="bacBetOn"><option>Player</option><option>Banker</option><option>Tie</option></select>
        <div class="muted">Amount</div><input id="bacBet" type="number" value="200" style="width:120px">
        <div class="spacer"></div>
        <button class="btn" id="bacDeal">Deal</button>
      </div>
      <div class="row" style="margin-top:10px"><div class="muted">Player</div><div id="bacP" class="cards"></div><div id="bacPT" style="font-weight:900"></div></div>
      <div class="row" style="margin-top:6px"><div class="muted">Banker</div><div id="bacB" class="cards"></div><div id="bacBT" style="font-weight:900"></div></div>
      <div id="bacMsg" class="muted" style="margin-top:8px"></div>
    `;
    const shoe = ()=>{
      const ranks=['A','2','3','4','5','6','7','8','9','10','J','Q','K']; const suits=['‚ô†','‚ô•','‚ô¶','‚ô£'];
      const d=[]; for(let k=0;k<6;k++) for(const r of ranks) for(const s of suits) d.push({r,s});
      for(let i=d.length-1;i>0;i--){ const j=rngInt(0,i); [d[i],d[j]]=[d[j],d[i]]; }
      return d;
    };
    const valCard = r => r==='A'?1:(['10','J','Q','K'].includes(r)?0:Number(r));
    const total = hand => hand.reduce((a,c)=> (a+valCard(c.r))%10, 0);
    let D = shoe();

    $('bacDeal').onclick = ()=>{
      const betOn = $('bacBetOn').value; let bet = +$('bacBet').value||0;
      if(bet<=0) return alert('Enter bet'); if(bet>state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState();
      // initial
      const P=[D.pop(),D.pop()], B=[D.pop(),D.pop()];
      renderHand('bacP', P); renderHand('bacB', B);
      let pt=total(P), bt=total(B);
      $('bacPT').innerText = pt; $('bacBT').innerText = bt;

      // natural
      if(pt>=8 || bt>=8) return settle();

      // Player rule
      let p3=null;
      if(pt<=5){ p3 = D.pop(); P.push(p3); pt=total(P); renderHand('bacP', P); $('bacPT').innerText = pt; }

      // Banker rule (simplified common rules)
      let drawB=false;
      if(!p3){ // Player stood
        if(bt<=5) drawB=true;
      } else {
        const v = valCard(p3.r);
        if(bt<=2) drawB=true;
        else if(bt===3 && v!==8) drawB=true;
        else if(bt===4 && v>=2 && v<=7) drawB=true;
        else if(bt===5 && v>=4 && v<=7) drawB=true;
        else if(bt===6 && (v===6 || v===7)) drawB=true;
      }
      if(drawB){ B.push(D.pop()); bt=total(B); renderHand('bacB', B); $('bacBT').innerText = bt; }

      settle();

      function settle(){
        pt=total(P); bt=total(B);
        const who = pt===bt ? 'Tie' : (pt>bt?'Player':'Banker');
        let msg = `Player ${pt} vs Banker ${bt} ‚Äî ${who}`;
        if(betOn===who){
          let mult = who==='Tie'?8: (who==='Banker'?1.95:2); // banker ~5% commission simulated as 1.95x
          const win = Math.round(bet*(mult)*100)/100;
          state.balance += win; saveState();
          msg += ` ‚Äî WIN +${(win-bet).toFixed(2)} SM`;
        } else {
          msg += ` ‚Äî lose ${bet} SM`;
        }
        $('bacMsg').innerText = msg;
      }
    };

    function renderHand(id, hand){
      const div=$(id); div.innerHTML='';
      hand.forEach(c=>{ const el=document.createElement('div'); el.className='cardUI'; el.textContent=c.r+c.s; div.appendChild(el); });
    }
  }

  // =========================================================
  // Keno
  // =========================================================
  function renderKeno(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Keno</h2>
      <div class="row" style="margin-top:8px">
        <div class="muted">Pick up to 10 numbers</div>
        <div class="spacer"></div>
        <div class="muted">Bet</div><input id="keBet" type="number" value="100" style="width:120px">
        <button class="btn" id="kePlay">Play</button>
      </div>
      <div id="keGrid" class="keno-grid" style="margin-top:10px"></div>
      <div id="keMsg" class="muted" style="margin-top:8px"></div>
    `;
    const grid=$('keGrid'); grid.innerHTML='';
    const sel=new Set();
    for(let i=1;i<=80;i++){
      const c=document.createElement('div'); c.className='keno-cell'; c.textContent=i; c.dataset.n=i;
      c.onclick=()=>{ if(sel.has(i)) { sel.delete(i); c.classList.remove('sel'); }
        else { if(sel.size>=10) return; sel.add(i); c.classList.add('sel'); } };
      grid.appendChild(c);
    }
    $('kePlay').onclick = async ()=>{
      const bet = +$('keBet').value||0; if(bet<=0) return alert('Enter bet'); if(sel.size===0) return alert('Pick at least one number');
      if(bet>state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState();
      // draw 20 numbers (unique)
      const nums = Array.from({length:80},(_,i)=>i+1);
      for(let i=nums.length-1;i>0;i--){ const j=rngInt(0,i); [nums[i],nums[j]]=[nums[j],nums[i]]; }
      const draw = nums.slice(0,20);
      // reveal
      const cells = qa('.keno-cell'); cells.forEach(c=>c.classList.remove('hit'));
      for(const n of draw){ await delay(40); const el = cells[n-1]; if(el){ el.classList.add('hit'); } }
      // hits
      let hits=0; for(const n of sel) if(draw.includes(n)) hits++;
      // simple payout table for k picks (balanced-ish)
      const k = sel.size;
      const mult = kenoPayout(k, hits);
      const profit = Math.round(bet*(mult-1)*100)/100;
      if(mult>1){ state.balance += bet + profit; saveState(); $('keMsg').innerText = `Picked ${k}, Hits ${hits} ‚Äî x${mult.toFixed(2)} ‚Üí +${profit.toFixed(2)} SM`; }
      else $('keMsg').innerText = `Picked ${k}, Hits ${hits} ‚Äî x${mult.toFixed(2)} ‚Üí -${bet.toFixed(2)} SM`;
    };

    function kenoPayout(k,h){
      // very simplified table
      const T={
        1:[0,0,2],
        2:[0,0,1.5,5],
        3:[0,0,1,2,10],
        4:[0,0,0.5,2,6,50],
        5:[0,0,0.5,1.5,4,20,100],
        6:[0,0,0.5,1,3,10,50,200],
        7:[0,0,0.5,1,2,5,20,80,300],
        8:[0,0,0.5,1,2,4,10,40,200,800],
        9:[0,0,0.5,1,2,4,8,20,80,400,1200],
        10:[0,0,0.5,1,2,4,8,20,60,300,1000,2500]
      };
      const row=T[k]||[]; return row[h]||0;
    }
  }

  // =========================================================
  // Tower (5 columns, one bomb per row; climb and cashout)
  // =========================================================
  function renderTower(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Tower</h2>
      <div class="row" style="margin-top:8px">
        <div class="muted">Rows</div><select id="twRows"><option>6</option><option selected>8</option><option>10</option></select>
        <div class="muted">Bet</div><input id="twBet" type="number" value="150" style="width:120px">
        <div class="spacer"></div>
        <button class="btn" id="twStart">Start</button>
        <button class="btn ghost" id="twCash">Cashout</button>
      </div>
      <div id="twArea" style="margin-top:12px;display:flex;flex-direction:column;gap:10px"></div>
      <div id="twMsg" class="muted" style="margin-top:8px"></div>
    `;
    const area=$('twArea');
    let rows=8, cur=0, bombs=[], running=false, bet=0;
    function build(){
      area.innerHTML=''; for(let r=0;r<rows;r++){ const row=document.createElement('div'); row.className='tower-row';
        for(let c=0;c<5;c++){ const cell=document.createElement('div'); cell.className='tower-cell'; cell.dataset.r=r; cell.dataset.c=c; row.appendChild(cell); }
        area.appendChild(row);
      }
    }
    area.onclick = (e)=>{
      const cell = e.target.closest('.tower-cell'); if(!cell||!running) return;
      const r = +cell.dataset.r, c=+cell.dataset.c; if(r!==cur) return;
      if(c===bombs[r]){ cell.classList.add('bomb'); running=false; $('twMsg').innerText = `Boom ‚Äî lost ${bet} SM`; }
      else{
        cell.classList.add('safe'); cur++;
        if(cur===rows){
          const mult = 1 + rows*0.25;
          const profit = Math.round(bet*(mult-1)*100)/100;
          state.balance += bet + profit; saveState();
          $('twMsg').innerText = `Completed tower x${mult.toFixed(2)} ‚Üí +${profit.toFixed(2)} SM`;
          running=false;
        } else $('twMsg').innerText = `Row ${cur}/${rows} ‚Äî pick next or cashout`;
      }
    };
    $('twStart').onclick = ()=>{
      rows = +$('twRows').value||8; bet = +$('twBet').value||0;
      if(bet<=0) return alert('Enter bet'); if(bet>state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState();
      cur=0; bombs=[]; running=true; build();
      for(let r=0;r<rows;r++) bombs[r]=rngInt(0,4);
      $('twMsg').innerText='Started ‚Äî pick a safe tile in the first row.';
    };
    $('twCash').onclick = ()=>{
      if(!running) return alert('No active round');
      const mult = 1 + cur*0.25;
      const profit = Math.round(bet*(mult-1)*100)/100;
      state.balance += bet + profit; saveState(); running=false;
      $('twMsg').innerText = `Cashed x${mult.toFixed(2)} ‚Üí +${profit.toFixed(2)} SM`;
    };
  }

  // =========================================================
  // Multiplier Wheel (bet on a segment type; spin)
  // =========================================================
  function renderWheel(){
    const main = $('mainGame');
    main.innerHTML = `
      <h2>Multiplier Wheel</h2>
      <div class="row" style="margin-top:8px">
        <div class="muted">Bet on</div>
        <select id="whOn"><option value="1">1x</option><option value="2">2x</option><option value="3">3x</option><option value="5">5x</option><option value="10">10x</option><option value="20">20x</option></select>
        <div class="muted">Bet</div><input id="whBet" type="number" value="150" style="width:120px">
        <div class="spacer"></div>
        <button class="btn" id="whSpin">Spin</button>
      </div>
      <div class="wheel-wrap">
        <div class="pointer"></div>
        <div class="wheel" id="wheel"></div>
      </div>
      <div id="whMsg" class="muted" style="text-align:center;margin-top:8px"></div>
    `;
    const segs = [
      {m:1, n:24},{m:2, n:12},{m:3, n:8},{m:5, n:6},{m:10, n:4},{m:20, n:2}
    ]; // total 56 segments
    const wheel = $('wheel'); wheel.innerHTML='';
    let total=0; segs.forEach(s=> total+=s.n);
    // draw segments visually (approx)
    let acc=0;
    for(const s of segs){
      for(let i=0;i<s.n;i++){
        const start = (acc/total)*360; acc++;
        const seg = document.createElement('div'); seg.className='seg';
        seg.style.transform = `rotate(${start}deg)`;
        seg.style.clipPath = 'polygon(50% 50%, 100% 0, 100% 100%)';
        seg.style.background = 'rgba(255,255,255,.03)';
        seg.textContent = s.m+'x';
        wheel.appendChild(seg);
      }
    }
    $('whSpin').onclick = async ()=>{
      const pick = +$('whOn').value;
      const bet = +$('whBet').value||0; if(bet<=0) return alert('Enter bet'); if(bet>state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState();
      const r = Math.random()*total|0;
      // final angle: point at top (0deg) ‚Äî rotate opposite of segment center
      const anglePerSeg = 360/total;
      const spinTurns = 4 + Math.random()*2;
      const finalAngle = (r + 0.5) * anglePerSeg;
      wheel.style.transition = 'transform 3.2s var(--ease)';
      wheel.style.transform = `rotate(${-(spinTurns*360 + finalAngle)}deg)`;
      await delay(3300);
      // determine multiplier
      let idx=r, cur=0, result=1;
      for(const s of segs){ if(idx < cur+s.n){ result = s.m; break; } cur += s.n; }
      if(result===pick){
        const profit = Math.round(bet*(result-1)*100)/100;
        state.balance += bet + profit; saveState();
        $('whMsg').innerText = `Result ${result}x ‚Äî WIN +${profit.toFixed(2)} SM`;
      }else{
        $('whMsg').innerText = `Result ${result}x ‚Äî lose ${bet.toFixed(2)} SM`;
      }
      // reset transition so subsequent spins animate fresh
      await delay(10); wheel.style.transition='none';
    };
  }

  // =========================================================
  // Boot
  // =========================================================
  loadState(); renderHeader(); bindStatic(); open('home');
  window.SpaceMeteor = { open, state };
});
</script>
</body>
</html>
