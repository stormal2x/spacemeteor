<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RainClone ‚Äî Clean Smooth (Demo)</title>
<style>
  :root{
    --bg:#05060a; --panel:#0f1418; --muted:#9ba3ab; --accent:#49d6ff; --accent-2:#7b61ff; --gold:#f5c156;
    --radius:12px; --glass: rgba(255,255,255,0.03);
    --ui-font: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    --ui-scale:1;
    --ease-quick:cubic-bezier(.2,.9,.25,1);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:var(--ui-font);background:
    radial-gradient(900px 360px at 8% 8%, rgba(73,214,255,0.03), transparent),
    linear-gradient(180deg,#05060a,#070714);color:#e6f2f8;-webkit-font-smoothing:antialiased}
  /* scale for accessibility */
  html{transform-origin:0 0;transform:scale(var(--ui-scale));}

  /* App layout: two columns (left nav + center content) */
  .app{max-width:1100px;margin:18px auto;display:grid;grid-template-columns:220px 1fr;gap:18px;padding:10px}
  header{grid-column:1/-1;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}
  .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;font-weight:900}
  h1{margin:0;font-size:18px}
  .tag{color:var(--muted);font-size:13px}

  /* Left column */
  .left{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.02);height:calc(100vh - 150px);overflow:auto}
  .wallet{margin-bottom:12px}
  .wallet .label{color:var(--muted);font-size:13px}
  .wallet .amount{font-weight:900;font-size:22px;color:var(--gold);margin-top:6px}
  .game-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .game-btn{display:flex;gap:10px;align-items:center;padding:10px;border-radius:10px;border:1px solid transparent;cursor:pointer;background:transparent;color:var(--muted);transition:all 200ms var(--ease-quick)}
  .game-btn.active{background:linear-gradient(90deg, rgba(73,214,255,0.05), rgba(123,97,255,0.03));color:var(--accent);border-color:rgba(73,214,255,0.06);box-shadow:0 18px 40px rgba(0,0,0,0.55)}

  /* center */
  .center{min-height:680px;border-radius:12px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:12px}
  .home-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .card{padding:16px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);cursor:pointer;border:1px solid rgba(255,255,255,0.02);transition:transform .18s var(--ease-quick), box-shadow .18s var(--ease-quick)}
  .card:hover{transform:translateY(-8px);box-shadow:0 20px 50px rgba(0,0,0,0.6)}
  .muted{color:var(--muted);font-size:13px}
  .focused{display:flex;gap:18px;align-items:flex-start}
  .main-game{flex:1;min-height:520px;border-radius:12px;padding:16px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02)}
  .side{width:260px;display:flex;flex-direction:column;gap:12px}

  /* small controls */
  .btn{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(180deg,var(--accent),rgba(72,214,255,0.85));color:#072;font-weight:800;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted)}
  input[type=number], select, input[type=text]{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}

  /* crash: SVG */
  .crash-area{display:flex;flex-direction:column;gap:12px}
  .crash-svg{width:100%;height:300px;border-radius:10px;overflow:hidden;background:linear-gradient(180deg, rgba(73,214,255,0.03), transparent)}

  /* slots */
  .slots-row{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:12px}
  .reel{width:140px;height:180px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);display:grid;place-items:center;font-size:64px;transition:transform 600ms var(--ease-quick)}
  .reel.stopping{transform:translateY(-6px) scale(1.02)}

  /* mines */
  .mines-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:8px}
  .mine-cell{height:64px;border-radius:8px;background:rgba(255,255,255,0.02);display:grid;place-items:center;font-weight:800;color:var(--muted);cursor:pointer;transition:all 160ms var(--ease-quick)}
  .mine-open{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));color:#fff;transform:translateY(-4px)}

  /* responsive */
  @media (max-width:1000px){
    .app{grid-template-columns:1fr; padding:12px}
    .home-grid{grid-template-columns:repeat(2,1fr)}
    .mines-grid{grid-template-columns:repeat(6,1fr)}
    .side{width:100%}
  }
</style>
</head>
<body>

<header>
  <div style="display:flex;gap:12px;align-items:center">
    <div class="logo">RC</div>
    <div>
      <h1>RainClone ‚Äî Clean Smooth</h1>
      <div class="muted">Minimal ‚Ä¢ Smooth ‚Ä¢ Demo</div>
    </div>
  </div>

  <div style="display:flex;gap:12px;align-items:center">
    <div class="muted">Balance</div>
    <div style="font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono';font-weight:900;color:var(--gold)" id="topBalance">0 RC</div>
    <div style="display:flex;gap:8px;align-items:center">
      <label class="muted">Reduce motion</label>
      <input type="checkbox" id="reducedMotionToggle">
      <button class="btn ghost" id="focusToggle" title="Focus mode (hide left nav)">Focus</button>
      <button class="btn" id="helpBtn">Tour</button>
    </div>
  </div>
</header>

<div class="app" role="application" aria-label="RainClone demo">
  <!-- LEFT -->
  <aside class="left" aria-label="Navigation">
    <div class="wallet">
      <div class="label">Wallet</div>
      <div class="amount" id="walletAmount">0 RC</div>
      <div class="muted" style="margin-top:6px">Local demo balance</div>
    </div>

    <div class="muted">Games</div>
    <div class="game-list" role="tablist" aria-label="Game list">
      <button class="game-btn active" data-game="home" role="tab">üè† Home</button>
      <button class="game-btn" data-game="crash" role="tab">üìà Crash</button>
      <button class="game-btn" data-game="dice" role="tab">üé≤ Dice</button>
      <button class="game-btn" data-game="mines" role="tab">üí£ Mines</button>
      <button class="game-btn" data-game="slots" role="tab">üé∞ Slots</button>
    </div>

    <div style="margin-top:12px">
      <div class="muted">Quick Add</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="quickAdd" type="number" value="200" aria-label="Quick add amount">
        <button class="btn ghost" id="addBtn">Add</button>
        <button class="btn ghost" id="undoAddBtn" title="Undo last quick add">Undo</button>
      </div>
    </div>
  </aside>

  <!-- CENTER -->
  <main class="center" id="center">
    <div id="homeView">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h2 style="margin:0">Welcome</h2>
          <div class="muted">Clean interface focused on the active game ‚Äî less clutter, smoother experience.</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="muted">UI Scale</div>
          <input id="uiScale" type="range" min="0.9" max="1.2" step="0.05" value="1" aria-label="UI scale">
        </div>
      </div>

      <div class="home-grid" style="margin-top:16px">
        <div class="card" data-open="crash"><strong>Crash</strong><div class="muted">Smooth SVG curve + manual/auto cashout.</div></div>
        <div class="card" data-open="dice"><strong>Dice</strong><div class="muted">Simple and big.</div></div>
        <div class="card" data-open="mines"><strong>Mines</strong><div class="muted">Open tiles, cashout when you want.</div></div>
        <div class="card" data-open="slots"><strong>Slots</strong><div class="muted">Staggered reel stops with easing.</div></div>
        <div class="card" data-open="home"><strong>Practice Mode</strong><div class="muted">Try smaller bets.</div></div>
        <div class="card" data-open="home"><strong>Export</strong><div class="muted">Export your demo state if you want.</div></div>
      </div>
    </div>

    <div id="gameView" style="display:none" class="focused" aria-live="polite">
      <div class="main-game" id="mainGame" aria-label="Main game area"><!-- injected content --></div>

      <div class="side" aria-label="Quick controls">
        <div class="panel">
          <div class="muted">Round</div>
          <div id="roundLabel" style="font-weight:900;margin-top:6px">‚Äî</div>
          <div id="roundSub" class="muted" style="margin-top:6px">Tips & status</div>
        </div>

        <div class="panel">
          <div class="muted">Quick Controls</div>
          <div style="margin-top:8px">
            <div class="muted">Bet</div>
            <input id="sideBet" type="number" value="150">
            <div style="display:flex;gap:8px;margin-top:10px">
              <button class="btn" id="sidePlace">Place</button>
              <button class="btn ghost" id="sideCash">Cashout</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </main>
</div>

<footer style="text-align:center;color:var(--muted);margin-top:12px">Demo only ‚Äî no real money. Tweak START_BALANCE in the script.</footer>

<script>
/* Clean Smooth edition ‚Äî simplified UI and removed session history & right column features.
   - Single-file demo
   - Keeps Crash, Slots, Dice, Mines
   - Left nav + center focused area
   - Fewer elements ‚Üí smoother experience
*/

document.addEventListener('DOMContentLoaded', () => {
  const START_BALANCE = 2500;
  const STORAGE_KEY = 'rainclone_clean_v1';
  const MAX_HISTORY = 300;

  const $ = id => document.getElementById(id);
  const qa = sel => Array.from(document.querySelectorAll(sel));
  const now = () => new Date().toLocaleTimeString();

  // state (we still keep history internally but it's not shown in UI)
  let state = {
    balance: START_BALANCE,
    wins: 0,
    losses: 0,
    history: [],
    crashHistory: [],
    lastAdd: null
  };

  function loadState(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw){
        const parsed = JSON.parse(raw);
        if(parsed && typeof parsed === 'object'){
          state = Object.assign(state, parsed);
          state.history = Array.isArray(state.history) ? state.history : [];
          state.crashHistory = Array.isArray(state.crashHistory) ? state.crashHistory : [];
        }
      }
    } catch(e){ console.warn('load failed', e); }
  }
  function saveState(){
    try {
      if($('persist') && $('persist').checked){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } else {
        // still update header
        renderHeader();
      }
    } catch(e){ console.warn('save failed', e); }
    renderHeader();
  }

  function renderHeader(){
    if($('topBalance')) $('topBalance').innerText = (state.balance || 0).toFixed(2) + ' RC';
    if($('walletAmount')) $('walletAmount').innerText = (state.balance || 0).toFixed(2) + ' RC';
    if($('roundLabel')) $('roundLabel').innerText = ''; // clear when switching
  }

  function pushHistory(entry){
    state.history.unshift(entry);
    if(state.history.length > MAX_HISTORY) state.history.length = MAX_HISTORY;
    if(entry.win) state.wins++; else if(entry.game !== 'System') state.losses++;
    if(entry.game === 'Crash' && typeof entry.extra === 'number'){
      state.crashHistory.unshift(entry.extra);
      if(state.crashHistory.length > 50) state.crashHistory.length = 50;
    }
    saveState();
  }

  // basic UI binding for static controls
  function bindStatic(){
    qa('.game-btn').forEach(btn=>{
      btn.addEventListener('click', ()=> {
        qa('.game-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        openGame(btn.dataset.game);
      });
    });
    qa('.card[data-open]').forEach(card=> card.addEventListener('click', ()=> {
      const g = card.dataset.open;
      const match = qa(`.game-btn[data-game="${g}"]`)[0];
      qa('.game-btn').forEach(b=>b.classList.remove('active'));
      match && match.classList.add('active');
      openGame(g);
    }));

    $('addBtn') && $('addBtn').addEventListener('click', ()=>{
      const v = Math.max(0, parseFloat($('quickAdd').value) || 0);
      if(!v) return;
      state.balance += v; state.lastAdd = v;
      pushHistory({game:'System', outcome:'Quick add', amt:v, time: now(), win:true});
      saveState();
    });
    $('undoAddBtn') && $('undoAddBtn').addEventListener('click', ()=>{
      if(!state.lastAdd) return alert('Nothing to undo');
      state.balance -= state.lastAdd;
      pushHistory({game:'System', outcome:'Undo add', amt:-state.lastAdd, time: now(), win:false});
      state.lastAdd = null; saveState();
    });

    $('uiScale') && $('uiScale').addEventListener('input', (e)=> {
      document.documentElement.style.setProperty('--ui-scale', e.target.value);
    });

    $('focusToggle') && $('focusToggle').addEventListener('click', ()=> {
      // hide left nav to focus on center
      const left = document.querySelector('.left');
      if(!left) return;
      if(left.style.display === 'none'){
        left.style.display = 'block';
        document.querySelector('.app').style.gridTemplateColumns = '220px 1fr';
        $('focusToggle').innerText = 'Focus';
      } else {
        left.style.display = 'none';
        document.querySelector('.app').style.gridTemplateColumns = '1fr';
        $('focusToggle').innerText = 'Unfocus';
      }
    });

    $('helpBtn') && $('helpBtn').addEventListener('click', ()=> {
      alert('Quick tour:\n\nLeft: select games and quick-add funds.\nCenter: focused game area. Use keyboard: Space = place; C = cashout.');
    });

    // reduced motion
    $('reducedMotionToggle') && $('reducedMotionToggle').addEventListener('change', (e)=> {
      const on = e.target.checked;
      document.documentElement.style.setProperty('--ease-quick', on ? 'linear' : 'cubic-bezier(.2,.9,.25,1)');
    });

    // keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.key === ' ') { e.preventDefault(); const place = $('sidePlace'); place && place.click(); }
      else if(e.key.toLowerCase() === 'c'){ const cash = $('sideCash'); cash && cash.click(); }
      else if(/^[1-5]$/.test(e.key)){ const map = {1:'home',2:'crash',3:'dice',4:'mines',5:'slots'}; const g = map[e.key]; const btn = qa(`.game-btn[data-game="${g}"]`)[0]; btn && btn.click(); }
    });
  }

  /* ---------- Game views ---------- */
  function openGame(name){
    const home = $('homeView'), game = $('gameView');
    if(!home || !game) return;
    home.style.display = name === 'home' ? 'block' : 'none';
    game.style.display = name === 'home' ? 'none' : 'flex';
    $('roundLabel') && ($('roundLabel').innerText = name.charAt(0).toUpperCase() + name.slice(1));
    const main = $('mainGame');
    if(!main) return;
    main.innerHTML = '';
    stopAllAnimations();
    if(name === 'crash') renderCrash();
    else if(name === 'slots') renderSlots();
    else if(name === 'dice') renderDice();
    else if(name === 'mines') renderMines();
    else openGame('home');
  }

  let globalRAFHandles = [];
  function registerRAF(id){ if(id) globalRAFHandles.push(id); }
  function stopAllAnimations(){ while(globalRAFHandles.length) cancelAnimationFrame(globalRAFHandles.pop()); }

  /* ---------- Crash (simplified, robust) ---------- */
  const crashState = { running:false, bet:0, mult:1, crashAt:0, raf:null };

  function deterministicCrashFromSeed(seed){
    let h = 2166136261 >>> 0;
    for (let i=0;i<seed.length;i++) h = Math.imul(h ^ seed.charCodeAt(i), 16777619) >>> 0;
    const r = (h % 100000) / 100000;
    const value = Math.max(1, Math.round((1 + Math.pow(1/(1-r+0.0001), 0.6)) * 100) / 100);
    return Math.min(200, value);
  }

  function renderCrash(){
    const main = $('mainGame'); if(!main) return;
    main.innerHTML = `
      <div class="crash-area">
        <h2>Crash</h2>
        <div class="muted">Place a bet and cash out before it crashes.</div>
        <svg id="crashSvg" class="crash-svg" viewBox="0 0 1000 300" preserveAspectRatio="none"></svg>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="display:flex;gap:8px;align-items:center">
            <div class="muted">Bet</div><input id="crashBet" type="number" value="150" style="width:120px">
            <div class="muted">Auto</div><input id="crashAuto" type="number" value="2.00" step="0.01" style="width:110px">
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="startCrash">Place & Start</button>
            <button class="btn ghost" id="cashCrash">Cashout</button>
          </div>
        </div>
        <div id="crashStatus" class="muted">Status: idle</div>
      </div>
    `;
    drawCrashSVG();

    $('startCrash') && $('startCrash').addEventListener('click', ()=>{
      const bet = Math.max(0, parseFloat($('crashBet').value) || 0);
      const auto = parseFloat($('crashAuto').value) || null;
      startCrash(bet, auto);
    });
    $('cashCrash') && $('cashCrash').addEventListener('click', ()=> {
      if(!crashState.running) return alert('No active crash');
      const cs = crashState;
      const profit = Math.round((cs.mult - 1) * cs.bet * 100)/100;
      state.balance += cs.bet + profit;
      pushHistory({game:'Crash', outcome:`Manual cashout @${cs.mult.toFixed(2)}x`, amt:profit, time: now(), win:true, extra: cs.crashAt});
      if(crashState.raf) cancelAnimationFrame(crashState.raf);
      crashState.running = false; crashState.raf = null;
      drawCrashSVG(); saveState(); renderHeader();
      $('crashStatus') && ($('crashStatus').innerText = `Cashed @${cs.mult.toFixed(2)}x (+${profit.toFixed(2)})`);
    });
  }

  function drawCrashSVG(){
    const svg = $('crashSvg'); if(!svg) return;
    while(svg.firstChild) svg.removeChild(svg.firstChild);
    const rect = document.createElementNS('http://www.w3.org/2000/svg','rect');
    rect.setAttribute('x','0'); rect.setAttribute('y','0'); rect.setAttribute('width','100%'); rect.setAttribute('height','100%');
    rect.setAttribute('fill','rgba(255,255,255,0.01)'); svg.appendChild(rect);
    const hist = state.crashHistory.slice(0,60).reverse();
    if(hist.length){
      const max = Math.max(...hist, 5);
      const points = hist.map((m,i) => {
        const x = Math.round(i*(1000/(hist.length-1||1)));
        const y = Math.round(280 - (Math.min(m,max)/max) * 240);
        return `${x},${y}`;
      }).join(' ');
      const poly = document.createElementNS('http://www.w3.org/2000/svg','polyline');
      poly.setAttribute('points', points);
      poly.setAttribute('fill','none');
      poly.setAttribute('stroke','url(#g1)');
      poly.setAttribute('stroke-width','3');
      const defs = document.createElementNS('http://www.w3.org/2000/svg','defs');
      const grad = document.createElementNS('http://www.w3.org/2000/svg','linearGradient');
      grad.setAttribute('id','g1'); grad.setAttribute('x1','0%'); grad.setAttribute('x2','100%');
      const s1 = document.createElementNS('http://www.w3.org/2000/svg','stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color','#49d6ff');
      const s2 = document.createElementNS('http://www.w3.org/2000/svg','stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color','#7b61ff');
      grad.appendChild(s1); grad.appendChild(s2); defs.appendChild(grad); svg.appendChild(defs);
      svg.appendChild(poly);
    } else {
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      path.setAttribute('d','M0,260 C200,180 400,130 600,90 800,60 1000,30');
      path.setAttribute('fill','none'); path.setAttribute('stroke','rgba(255,255,255,0.03)'); path.setAttribute('stroke-width','2');
      svg.appendChild(path);
    }
  }

  function startCrash(bet, autoCash){
    if(crashState.running) return alert('Already running');
    if(!bet || bet <= 0) return alert('Enter bet');
    if(bet > state.balance) return alert('Not enough funds');
    state.balance -= bet; renderHeader();
    const seed = Date.now().toString(36) + Math.random().toString(36).slice(2);
    const crashAt = deterministicCrashFromSeed(seed);
    crashState.running = true; crashState.bet = bet; crashState.mult = 1; crashState.crashAt = crashAt;
    $('crashStatus') && ($('crashStatus').innerText = 'Running...');
    let last = performance.now();
    function loop(now){
      if(!crashState.running) return;
      const dt = (now - last)/1000; last = now;
      crashState.mult += dt * (0.9 + Math.log(crashState.mult + 1) * 0.55);
      if(autoCash && crashState.mult >= autoCash){
        const profit = Math.round((autoCash - 1) * bet * 100)/100;
        state.balance += bet + profit;
        pushHistory({game:'Crash', outcome:`Auto cashout @${autoCash.toFixed(2)}x`, amt:profit, time: now(), win:true, extra: crashAt});
        crashState.running = false; crashState.raf = null;
        drawCrashSVG(); saveState(); renderHeader();
        $('crashStatus') && ($('crashStatus').innerText = `Auto-cashed @${autoCash.toFixed(2)}x (+${profit.toFixed(2)})`);
        return;
      }
      if(crashState.mult >= crashState.crashAt){
        pushHistory({game:'Crash', outcome:`Crashed @${crashState.crashAt.toFixed(2)}x`, amt:-bet, time: now(), win:false, extra: crashAt});
        crashState.running = false; crashState.raf = null;
        drawCrashSVG(); saveState(); renderHeader();
        $('crashStatus') && ($('crashStatus').innerText = `Crashed @${crashState.crashAt.toFixed(2)}x ‚Äî lost ${bet} RC`);
        return;
      }
      // expose current for manual cashout support
      window.__crashLive = {mult: crashState.mult, bet: crashState.bet, crashAt: crashState.crashAt, running: crashState.running};
      $('crashStatus') && ($('crashStatus').innerText = `Running ‚Äî ${crashState.mult.toFixed(2)}x`);
      crashState.raf = requestAnimationFrame(loop);
      registerRAF(crashState.raf);
    }
    crashState.raf = requestAnimationFrame(loop);
    registerRAF(crashState.raf);
  }

  /* ---------- Slots ---------- */
  function renderSlots(){
    const main = $('mainGame'); if(!main) return;
    main.innerHTML = `
      <h2>Slots</h2>
      <div class="muted">Staggered reel stops and clean feedback.</div>
      <div class="slots-row" style="margin-top:12px">
        <div class="reel" id="r1">üçí</div>
        <div class="reel" id="r2">üçã</div>
        <div class="reel" id="r3">üîî</div>
      </div>
      <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
        <div class="muted">Bet</div><input id="slotsBet" type="number" value="150" style="width:120px">
        <button class="btn" id="spinBtn">Spin</button>
        <div id="slotsMsg" class="muted">Match 3 for big rewards.</div>
      </div>
    `;
    const symbols = ['üçí','üçã','üîî','‚≠ê','7Ô∏è‚É£'];
    const r1 = $('r1'), r2 = $('r2'), r3 = $('r3');
    let spinning = false;
    function pick(){ return symbols[Math.floor(Math.random()*symbols.length)]; }
    async function spin(){
      if(spinning) return;
      const bet = Math.max(0, parseFloat($('slotsBet').value) || 0);
      if(!bet) return alert('Enter bet'); if(bet > state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState(); renderHeader();
      spinning = true;
      [r1,r2,r3].forEach(el=> el.classList.add('stopping'));
      const t1 = pick(), t2 = pick(), t3 = pick();
      await delay(220); r1.classList.remove('stopping'); r1.innerText = t1;
      await delay(160); r2.classList.remove('stopping'); r2.innerText = t2;
      await delay(180); r3.classList.remove('stopping'); r3.innerText = t3;
      let profit = 0;
      if(t1===t2 && t2===t3) profit = (t1==='7Ô∏è‚É£') ? bet*50 : bet*10;
      else if(t1===t2 || t2===t3 || t1===t3) profit = bet*2;
      if(profit>0){
        state.balance += bet + profit;
        pushHistory({game:'Slots', outcome:'Win', amt:profit, time: now(), win:true});
        $('slotsMsg').innerText = `Win +${profit.toFixed(2)} RC`;
      } else {
        pushHistory({game:'Slots', outcome:'Lose', amt:-bet, time: now(), win:false});
        $('slotsMsg').innerText = `No match ‚Äî lost ${bet.toFixed(2)} RC`;
      }
      saveState(); renderHeader();
      spinning = false;
    }
    $('spinBtn') && $('spinBtn').addEventListener('click', spin);
  }

  /* ---------- Dice ---------- */
  function renderDice(){
    const main = $('mainGame'); if(!main) return;
    main.innerHTML = `
      <h2>Dice</h2>
      <div class="muted">Pick a target (4-6). Roll 1-6.</div>
      <div style="display:flex;gap:24px;align-items:center;margin-top:16px">
        <div style="display:flex;flex-direction:column;gap:8px;align-items:center">
          <div class="muted">Pick</div>
          <select id="dicePick" style="padding:8px;border-radius:8px"><option value="4">‚â•4</option><option value="5">‚â•5</option><option value="6">=6</option></select>
          <div class="muted">Bet</div><input id="diceBet" type="number" value="150" style="width:120px">
          <button class="btn" id="diceRoll">Roll</button>
        </div>
        <div style="text-align:center">
          <div class="muted">Result</div>
          <div id="diceFace" style="font-size:120px;padding:18px;margin-top:8px;background:rgba(255,255,255,0.02);border-radius:14px">‚Äî</div>
          <div id="diceMsg" class="muted" style="margin-top:8px">Roll to play</div>
        </div>
      </div>
    `;
    $('diceRoll') && $('diceRoll').addEventListener('click', ()=>{
      const pick = parseInt($('dicePick').value,10);
      const bet = Math.max(0, parseFloat($('diceBet').value) || 0);
      if(!bet) return alert('Enter bet'); if(bet > state.balance) return alert('Not enough funds');
      state.balance -= bet; saveState(); renderHeader();
      const roll = Math.floor(Math.random()*6)+1;
      let win=false, profit=0;
      if(pick===6){ if(roll===6){ win=true; profit=bet*5; } }
      else { if(roll>=pick){ win=true; profit = Math.round((bet * (6/(6-(pick-1)) - 1)) * 100)/100; } }
      $('diceFace').innerText = roll;
      if(win){ state.balance += bet + profit; pushHistory({game:'Dice', outcome:`Rolled ${roll} ‚Äî Win`, amt:profit, time: now(), win:true}); $('diceMsg').innerText = `WIN +${profit.toFixed(2)} RC`; }
      else { pushHistory({game:'Dice', outcome:`Rolled ${roll} ‚Äî Lose`, amt:-bet, time: now(), win:false}); $('diceMsg').innerText = `LOSE -${bet.toFixed(2)} RC`; }
      saveState(); renderHeader();
    });
  }

  /* ---------- Mines ---------- */
  function renderMines(){
    const main = $('mainGame'); if(!main) return;
    main.innerHTML = `
      <h2>Mines</h2>
      <div class="muted">Open cells. Bomb ends round. Cashout anytime.</div>
      <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
        <div><div class="muted">Bombs</div><select id="bombs" style="padding:8px;border-radius:8px"><option value="3">3</option><option value="5" selected>5</option><option value="8">8</option></select></div>
        <div><div class="muted">Bet</div><input id="minesBet" type="number" value="150" style="width:120px"></div>
        <div style="margin-left:auto"><button class="btn" id="startMines">Start</button><button class="btn ghost" id="cashMines">Cashout</button></div>
      </div>
      <div class="mines-grid" id="minesGrid" style="margin-top:12px"></div>
      <div id="minesMsg" class="muted" style="margin-top:8px"></div>
    `;
    const grid = $('minesGrid'); if(!grid) return;
    function makeGrid(){ grid.innerHTML=''; for(let i=0;i<48;i++){ const c=document.createElement('div'); c.className='mine-cell'; c.dataset.i=i; c.innerText='?'; grid.appendChild(c);} }
    makeGrid();
    let bombs = new Set(), opened = new Set(), running=false, curBet=0;
    grid.addEventListener('click', (e)=>{
      const cell = e.target.closest('.mine-cell'); if(!cell) return;
      const idx = Number(cell.dataset.i);
      if(!running) return;
      if(opened.has(idx)) return;
      opened.add(idx);
      if(bombs.has(idx)){
        cell.classList.add('mine-open'); cell.innerText='üí£';
        running=false;
        pushHistory({game:'Mines', outcome:'Hit bomb', amt:-curBet, time: now(), win:false});
        $('minesMsg').innerText='Boom ‚Äî you hit a bomb.';
        saveState(); renderHeader();
      } else {
        cell.classList.add('mine-open'); cell.innerText='‚Ä¢';
        const mul = 1 + (opened.size * 0.12);
        $('minesMsg').innerText = `Safe ‚Äî x${mul.toFixed(2)} ‚Äî open more or cashout.`;
      }
    });
    $('startMines') && $('startMines').addEventListener('click', ()=>{
      const bet = Math.max(0, parseFloat($('minesBet').value) || 0);
      if(!bet) return alert('Enter bet'); if(bet > state.balance) return alert('Not enough funds');
      const count = parseInt($('bombs').value,10);
      state.balance -= bet; saveState(); renderHeader();
      curBet = bet; running=true; opened.clear(); bombs.clear();
      while(bombs.size < count) bombs.add(Math.floor(Math.random()*48));
      grid.querySelectorAll('.mine-cell').forEach(c=>{ c.classList.remove('mine-open'); c.innerText='?'; });
      pushHistory({game:'Mines', outcome:'Started', amt:-bet, time: now(), win:false});
      $('minesMsg').innerText = 'Round started ‚Äî open tiles.';
    });
    $('cashMines') && $('cashMines').addEventListener('click', ()=>{
      if(!running) return alert('No active round');
      const mul = 1 + (opened.size * 0.12);
      const profit = Math.round((curBet * (mul - 1)) * 100)/100;
      state.balance += curBet + profit;
      pushHistory({game:'Mines', outcome:`Cashed x${mul.toFixed(2)}`, amt:profit, time: now(), win:true});
      running=false; saveState(); renderHeader(); $('minesMsg').innerText = `Cashed out +${profit.toFixed(2)} RC`;
    });
  }

  /* ---------- Utilities ---------- */
  function delay(ms){ return new Promise(r=>setTimeout(r, ms)); }

  /* ---------- Init ---------- */
  loadState();
  renderHeader();
  bindStatic();
  openGame('home');
  // save on unload
  window.addEventListener('beforeunload', ()=> saveState());

  // expose minimal debug helpers
  window.RainClone = { state, saveState, openGame };

}); // DOMContentLoaded
</script>

</body>
</html>
